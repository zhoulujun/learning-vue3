<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.41">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="https://chengpeiquan.com/favicon.ico"><meta name="keywords" content="vue 3, vue 3.x, vue 3 入门, vue 3 教程, 学习 vue 3, vue 3 案例, vue 3 教学, vue 3 好用吗"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png"><link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png"><meta name="msapplication-TileColor" content="#000000"><title>路由的使用 | Vue3 入门指南与实战案例</title><meta name="description" content="这是一个关于 Vue 3 + TypeScript 的起步学习教程，适合完全的Vue新手和Vue 2.0的老手，在官方文档的基础上融入自己的一些实践经验。">
    <link rel="modulepreload" href="/assets/app.0c7b3152.js"><link rel="modulepreload" href="/assets/router.html.60990ba2.js"><link rel="modulepreload" href="/assets/router.html.86285e99.js"><link rel="prefetch" href="/assets/index.html.2f003589.js"><link rel="prefetch" href="/assets/communication.html.be61d0ec.js"><link rel="prefetch" href="/assets/component.html.3d44d9c3.js"><link rel="prefetch" href="/assets/efficient.html.a26166bb.js"><link rel="prefetch" href="/assets/guide.html.adff52ae.js"><link rel="prefetch" href="/assets/links.html.b094a747.js"><link rel="prefetch" href="/assets/pinia.html.7109bbd7.js"><link rel="prefetch" href="/assets/plugin.html.e84e0166.js"><link rel="prefetch" href="/assets/update.html.e870f97c.js"><link rel="prefetch" href="/assets/404.html.9b42cd8b.js"><link rel="prefetch" href="/assets/index.html.5f058d06.js"><link rel="prefetch" href="/assets/communication.html.19f6b2f7.js"><link rel="prefetch" href="/assets/component.html.f5307f9d.js"><link rel="prefetch" href="/assets/efficient.html.ad1f20a6.js"><link rel="prefetch" href="/assets/guide.html.90f201ac.js"><link rel="prefetch" href="/assets/links.html.62996d14.js"><link rel="prefetch" href="/assets/pinia.html.642f88d2.js"><link rel="prefetch" href="/assets/plugin.html.eb66815b.js"><link rel="prefetch" href="/assets/update.html.100e2c95.js"><link rel="prefetch" href="/assets/404.html.4675e898.js"><link rel="prefetch" href="/assets/404.d3026537.js"><link rel="prefetch" href="/assets/Layout.527176c4.js"><link rel="prefetch" href="/assets/GitalkComment.3ff1abe3.js"><link rel="prefetch" href="/assets/GoogleAdsense.40b4bcba.js"><link rel="prefetch" href="/assets/ImgWrap.abf53801.js">
    <link rel="stylesheet" href="/assets/style.515263ec.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="https://vue3.chengpeiquan.com/assets/img/vue3.png" alt="Vue3 入门指南与实战案例"><span class="site-name can-hide">Vue3 入门指南与实战案例</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://chengpeiquan.com/" rel="noopener noreferrer" target="_blank" aria-label="博客首页"><!--[--><!--]--> 博客首页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/cooking-cookbook" rel="noopener noreferrer" target="_blank" aria-label="菜谱教程"><!--[--><!--]--> 菜谱教程 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/learning-vue3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://chengpeiquan.com/" rel="noopener noreferrer" target="_blank" aria-label="博客首页"><!--[--><!--]--> 博客首页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/cooking-cookbook" rel="noopener noreferrer" target="_blank" aria-label="菜谱教程"><!--[--><!--]--> 菜谱教程 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/learning-vue3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----></li><li><a href="/guide.html" class="sidebar-item sidebar-heading" aria-label="起步准备"><!--[--><!--]--> 起步准备 <!--[--><!--]--></a><!----></li><li><a href="/update.html" class="sidebar-item sidebar-heading" aria-label="升级与配置"><!--[--><!--]--> 升级与配置 <!--[--><!--]--></a><!----></li><li><a href="/component.html" class="sidebar-item sidebar-heading" aria-label="单组件的编写"><!--[--><!--]--> 单组件的编写 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="路由的使用"><!--[--><!--]--> 路由的使用 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#路由的目录结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由的目录结构"><!--[--><!--]--> 路由的目录结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#在项目里引入路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="在项目里引入路由"><!--[--><!--]--> 在项目里引入路由 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#回顾-vue-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="回顾 Vue 2"><!--[--><!--]--> 回顾 Vue 2 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#了解-vue-3-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="了解 Vue 3{new}"><!--[--><!--]--> 了解 Vue 3{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#路由树的配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由树的配置"><!--[--><!--]--> 路由树的配置 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#基础格式-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="基础格式{new}"><!--[--><!--]--> 基础格式{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#公共路径" class="router-link-active router-link-exact-active sidebar-item" aria-label="公共路径"><!--[--><!--]--> 公共路径 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#一级路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="一级路由"><!--[--><!--]--> 一级路由 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#同步组件" class="router-link-active router-link-exact-active sidebar-item" aria-label="同步组件"><!--[--><!--]--> 同步组件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#异步组件" class="router-link-active router-link-exact-active sidebar-item" aria-label="异步组件"><!--[--><!--]--> 异步组件 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#多级路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="多级路由"><!--[--><!--]--> 多级路由 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#路由懒加载" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由懒加载"><!--[--><!--]--> 路由懒加载 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#路由的渲染" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由的渲染"><!--[--><!--]--> 路由的渲染 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#使用-route-获取路由信息-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 route 获取路由信息{new}"><!--[--><!--]--> 使用 route 获取路由信息{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#使用-router-操作路由-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 router 操作路由{new}"><!--[--><!--]--> 使用 router 操作路由{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#使用-router-link-标签跳转" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 router-link 标签跳转"><!--[--><!--]--> 使用 router-link 标签跳转 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#基础跳转" class="router-link-active router-link-exact-active sidebar-item" aria-label="基础跳转"><!--[--><!--]--> 基础跳转 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#带参数的跳转" class="router-link-active router-link-exact-active sidebar-item" aria-label="带参数的跳转"><!--[--><!--]--> 带参数的跳转 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#不生成-a-标签-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="不生成 a 标签{new}"><!--[--><!--]--> 不生成 a 标签{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#在独立-ts-js-文件里使用路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="在独立 TS/JS 文件里使用路由"><!--[--><!--]--> 在独立 TS/JS 文件里使用路由 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#路由元信息配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由元信息配置"><!--[--><!--]--> 路由元信息配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#路由重定向" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由重定向"><!--[--><!--]--> 路由重定向 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#业务场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="业务场景"><!--[--><!--]--> 业务场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#配置为-path" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置为 path"><!--[--><!--]--> 配置为 path <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#配置为-route" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置为 route"><!--[--><!--]--> 配置为 route <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#配置为-function" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置为 function"><!--[--><!--]--> 配置为 function <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#路由别名配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由别名配置"><!--[--><!--]--> 路由别名配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#_404路由页面配置-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="404路由页面配置{new}"><!--[--><!--]--> 404路由页面配置{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#导航守卫" class="router-link-active router-link-exact-active sidebar-item" aria-label="导航守卫"><!--[--><!--]--> 导航守卫 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#钩子的应用场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="钩子的应用场景"><!--[--><!--]--> 钩子的应用场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#路由里的全局钩子" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由里的全局钩子"><!--[--><!--]--> 路由里的全局钩子 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#beforeeach-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="beforeEach{new}"><!--[--><!--]--> beforeEach{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#beforeresolve" class="router-link-active router-link-exact-active sidebar-item" aria-label="beforeResolve"><!--[--><!--]--> beforeResolve <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#aftereach" class="router-link-active router-link-exact-active sidebar-item" aria-label="afterEach"><!--[--><!--]--> afterEach <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#在组件内使用全局钩子" class="router-link-active router-link-exact-active sidebar-item" aria-label="在组件内使用全局钩子"><!--[--><!--]--> 在组件内使用全局钩子 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#路由里的独享钩子" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由里的独享钩子"><!--[--><!--]--> 路由里的独享钩子 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#beforeenter-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="beforeEnter{new}"><!--[--><!--]--> beforeEnter{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#组件内单独使用-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="组件内单独使用{new}"><!--[--><!--]--> 组件内单独使用{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#onbeforerouteupdate-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="onBeforeRouteUpdate{new}"><!--[--><!--]--> onBeforeRouteUpdate{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#onbeforerouteleave-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="onBeforeRouteLeave{new}"><!--[--><!--]--> onBeforeRouteLeave{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#路由监听" class="router-link-active router-link-exact-active sidebar-item" aria-label="路由监听"><!--[--><!--]--> 路由监听 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#watch-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="watch{new}"><!--[--><!--]--> watch{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#watcheffect-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="watchEffect{new}"><!--[--><!--]--> watchEffect{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#部署问题与服务端配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="部署问题与服务端配置"><!--[--><!--]--> 部署问题与服务端配置 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#常见部署问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="常见部署问题"><!--[--><!--]--> 常见部署问题 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#页面刷新就-404" class="router-link-active router-link-exact-active sidebar-item" aria-label="页面刷新就 404"><!--[--><!--]--> 页面刷新就 404 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#问题原因" class="router-link-active router-link-exact-active sidebar-item" aria-label="问题原因"><!--[--><!--]--> 问题原因 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#解决方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#部分路由白屏" class="router-link-active router-link-exact-active sidebar-item" aria-label="部分路由白屏"><!--[--><!--]--> 部分路由白屏 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#问题原因-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="问题原因"><!--[--><!--]--> 问题原因 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#解决方案-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#服务端配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="服务端配置"><!--[--><!--]--> 服务端配置 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/router.html#nginx" class="router-link-active router-link-exact-active sidebar-item" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#express" class="router-link-active router-link-exact-active sidebar-item" aria-label="Express"><!--[--><!--]--> Express <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/router.html#更多方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="更多方案"><!--[--><!--]--> 更多方案 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/router.html#本章结语" class="router-link-active router-link-exact-active sidebar-item" aria-label="本章结语"><!--[--><!--]--> 本章结语 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/plugin.html" class="sidebar-item sidebar-heading" aria-label="插件的使用"><!--[--><!--]--> 插件的使用 <!--[--><!--]--></a><!----></li><li><a href="/communication.html" class="sidebar-item sidebar-heading" aria-label="组件之间的通信"><!--[--><!--]--> 组件之间的通信 <!--[--><!--]--></a><!----></li><li><a href="/pinia.html" class="sidebar-item sidebar-heading" aria-label="全局状态的管理"><!--[--><!--]--> 全局状态的管理 <!--[--><!--]--></a><!----></li><li><a href="/efficient.html" class="sidebar-item sidebar-heading" aria-label="高效开发"><!--[--><!--]--> 高效开发 <!--[--><!--]--></a><!----></li><li><a href="/links.html" class="sidebar-item sidebar-heading" aria-label="拓展阅读"><!--[--><!--]--> 拓展阅读 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="路由的使用" tabindex="-1"><a class="header-anchor" href="#路由的使用" aria-hidden="true">#</a> 路由的使用</h1><p>在传统的 Web 开发过程中，当你需要实现多个站内页面时，以前你需要写很多个 html 页面，然后通过 a 标签来实现互相跳转。</p><p>在如今 SPA 当道的时代，像 Vue 工程，可以轻松的通过配置一个生态组件，来实现只用一个 html ，却能够完成多个站内页面渲染、跳转的功能。</p><p>这个生态组件，就是路由。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>从这里开始，所有包含到 .vue 文件引入的地方，可能会看到 <code>@xx/xx.vue</code> 这样的写法。</p><p><code>@views</code> 是 <code>src/views</code> 的路径别名，<code>@cp</code> 是 <code>src/components</code> 的路径别名。</p><p>路径别名可以在 <code>vue.config.js</code> 里配置 <code>alias</code>，点击了解：<a href="/update.html#%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE" class="">添加项目配置</a></p></div><h2 id="路由的目录结构" tabindex="-1"><a class="header-anchor" href="#路由的目录结构" aria-hidden="true">#</a> 路由的目录结构</h2><p>3.x 引入路由的方式和 2.x 一样，如果你也是在创建 Vue 项目的时候选择了带上路由，那么会自动帮你在 <code>src</code> 文件夹下创建如下的目录结构。</p><p>如果创建时没有选择，那么也可以按照这个结构自己创建对应的文件。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>src
├─router
├───index.ts
├───routes.ts
└─main.ts
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其中 <code>index.ts</code> 是路由的入口文件，系统安装的时候也只有这个文件，<code>routes.ts</code> 是我自己加的，主要用于集中管理路由，<code>index.ts</code> 只用于编写路由的创建、拦截等逻辑功能。</p><p>因为大型项目来说，路由树是很粗壮的，往往需要配置上二级、三级路由，逻辑和配置都放到一个文件的话，太臃肿了。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>需要注意的是，与 Vue 3 配套的路由版本是 vue-router 4.x 以上，也就是如果一开始创建没有选择路由的话，后续自己安装，需要选择 <code>vue-router@4</code> 或者 <code>vue-router@latest</code> 才可以正确匹配。</p></div><h2 id="在项目里引入路由" tabindex="-1"><a class="header-anchor" href="#在项目里引入路由" aria-hidden="true">#</a> 在项目里引入路由</h2><p>不管是 Vue 2 还是 Vue 3 ，引入路由都是在 <code>index.js</code> / <code>index.ts</code> 文件里，但是版本升级带来的变化很大，由于我们的 Vue 3.0 是写 TypeScript ，所以这里只做一个 TS 的变化对比。</p><h3 id="回顾-vue-2" tabindex="-1"><a class="header-anchor" href="#回顾-vue-2" aria-hidden="true">#</a> 回顾 Vue 2</h3><p>Vue 2 的引入方式如下（其中 <code>RouteConfig</code> 是路由项目的 TS 类型定义）。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> VueRouter<span class="token punctuation">,</span> <span class="token punctuation">{</span> RouteConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteConfig<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&#39;history&#39;</span><span class="token punctuation">,</span>
  base<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">,</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>里面一些选项的功能说明：</p><ol><li><p><code>routes</code> 是路由树的配置，当你的路由很粗壮的时候你可以集中到 <code>routes.ts</code> 管理然后再 <code>import</code> 进来（具体的配置请看后面的 <a href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">路由配置部分</a> 说明）。</p></li><li><p><code>mode</code> 决定访问路径模式，可配置为 <code>hash</code> 或者 <code>history</code>，hash 模式是这种 <code>http://abc.com/#/home</code> 这样带 # 号的地址，支持所有浏览器，history 模式是 <code>http://abc.com/home</code> 这样不带 # 号，不仅美观，而且体验更好，但需要服务端做一些配置支持，也只对主流浏览器支持。</p></li></ol><p>相关阅读：<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90" target="_blank" rel="noopener noreferrer">后端配置例子 - HTML5 History 模式<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ol start="3"><li><code>base</code> 是 history 模式在进行路由切换时的基础路径，默认是 <code>/</code> 根目录，如果你的项目不是部署在根目录下，而是二级目录、三级目录等多级目录，就必须指定这个 base ，不然路由切换会有问题。</li></ol><h3 id="了解-vue-3-new" tabindex="-1"><a class="header-anchor" href="#了解-vue-3-new" aria-hidden="true">#</a> 了解 Vue 3{new}</h3><p>Vue 3 的引入方式如下（其中 <code>RouteRecordRaw</code> 是路由项目的 TS 类型定义）。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory<span class="token punctuation">,</span> RouteRecordRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  history<span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在 Vue 3 （也就是 vue-router 4.x） 里，路由简化了一些配置项，里面一些选项的功能说明：</p><ol><li><p><code>routes</code> 和 2.x 一样，是路由树的配置。</p></li><li><p><code>history</code> 和 2.x 有所不同，在 3.x ，使用 <code>history</code> 来代替 2.x 的 <code>mode</code> ，但功能是一样的，也是决定访问路径模式是 <code>hash</code> 模式 还是 <code>history</code> 模式，同时合并了 Vue 2 （也就是 vue-router 3.x） 的 <code>base</code> 选项作为模式函数的入参。</p></li></ol><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>当然，和在使用 Vue 2 的时候一样，你还可以配置一些额外的路由选项。</p></div><p>比如：指定 <code>router-link</code> 针对活动路由所匹配的 <code>className</code> :</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  history<span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  linkActiveClass<span class="token operator">:</span> <span class="token string">&#39;cur&#39;</span><span class="token punctuation">,</span>
  linkExactActiveClass<span class="token operator">:</span> <span class="token string">&#39;cur&#39;</span><span class="token punctuation">,</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>更多的配置项可以参考官网： <a href="https://next.router.vuejs.org/api/#routeroptions" target="_blank" rel="noopener noreferrer">RouterOptions - Vue Router<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="路由树的配置" tabindex="-1"><a class="header-anchor" href="#路由树的配置" aria-hidden="true">#</a> 路由树的配置</h2><p>在 <a href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E9%87%8C%E5%BC%95%E5%85%A5%E8%B7%AF%E7%94%B1">引入路由</a> 部分有说到，当你的路由很粗壮的时候，你可以集中到 <code>routes.ts</code> 管理然后再 <code>import</code> 到 <code>index.ts</code> 里。</p><p>我们暂且把 <code>routes.ts</code> 这个文件称为“路由树”，因为它像一棵大树一样，不仅可以以一级路由为树干去生长，还可以添加二级、三级等多级路由来开枝散叶。</p><p>那我们来看看 <code>routes.ts</code> 应该怎么写：</p><h3 id="基础格式-new" tabindex="-1"><a class="header-anchor" href="#基础格式-new" aria-hidden="true">#</a> 基础格式{new}</h3><p>在TS里，路由文件的基础格式由三个部分组成：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// TS需要引入每个路由的类型定义</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RouteRecordRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token comment">// 定义一个路由数组</span>
<span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 暴露定义好的路由数据</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> routes<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>之后就可以在 <code>index.ts</code> 里导入使用了。</p><p>那么里面的路由数组又是怎么写呢？这里就涉及到了 <a href="#%E4%B8%80%E7%BA%A7%E8%B7%AF%E7%94%B1">一级路由</a> 和 <a href="#%E5%A4%9A%E7%BA%A7%E8%B7%AF%E7%94%B1">多级路由</a> 的编写。</p><h3 id="公共路径" tabindex="-1"><a class="header-anchor" href="#公共路径" aria-hidden="true">#</a> 公共路径</h3><p>在配置路由之前，需要先了解公共路径（publicPath）的概念，在 <a href="/update.html#%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE" class="">添加项目配置</a> 部分，我们里面有一个参数，叫 <code>publicPath</code>，其实就是用来控制路由的公共路径，那么它有什么用呢？</p><p><code>publicPath</code> 的默认值是 <code>/</code>，也就是说，如果你不配置它，那么所有的资源文件都是从域名根目录读取，如果你的项目部署在域名根目录那当然好，但是如果不是呢？那么就必须来配置它了。</p><p>配置很简单，只要把项目要上线的最终地址，去掉域名，剩下的那部分就是 <code>publicPath</code> 。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>如果你的路由只有一级，那么 <code>publicPath</code> 也可以设置为相对路径 <code>./</code>，这样你可以把项目部署到任意地方。</p><p>如果路由不止一级，那么请准确的指定 <code>publicPath</code>，并且保证它是以 <code>/</code> 开头， <code>/</code> 结尾。</p></div><p>假设你的项目是部署在 <code>https://chengpeiquan.com/vue3/</code> ，那么 <code>publicPath</code> 就可以设置为 <code>/vue3/</code>。</p><p>通常我们开发环境，也就是本机ip访问的时候，都是基于根目录，但上线后的就不一定是根目录了，那么你在 <code>vue.config.js</code> 里可以通过环境变量来指定不同环境使用不同的 <code>publicPath</code>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">IS_DEV</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token constant">IS_DEV</span> <span class="token operator">?</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;/vue3/&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="一级路由" tabindex="-1"><a class="header-anchor" href="#一级路由" aria-hidden="true">#</a> 一级路由</h3><p>一级路由，顾名思义，就是在我们的项目地址后面，只有一级path，比如 <code>https://chengpeiquan.com/home</code> 这里的 <code>home</code> 就是一级路由。</p><p>我们来看一下最基本的路由配置应该包含哪些字段：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li><code>path</code> 是路由的访问路径，像上面说的，如果你的域名是 <code>https://chengpeiquan.com/</code>， 配置为 <code>/home</code>，那么访问路径就是 <code>https://chengpeiquan.com/home</code></li></ol><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>一级路由的path都必须是以 <code>/</code> 开头，比如： <code>/home</code>、<code>/setting</code>；</p><p>如果你的项目首页不想带上 <code>home</code> 之类的尾巴，只想要 <code>https://chengpeiquan.com/</code> 这样的域名直达 ，其实也是配置一级路由，只需要把路由的 <code>path</code> 指定为 <code>/</code> 即可。</p></div><ol start="2"><li><p><code>name</code> 是路由的名称，非必填，但是一般都会配置上去，这样可以很方便的通过 <code>name</code> 来代替 <code>path</code> 实现路由的跳转，因为像有时候你的开发环境和生产环境的路径不一致，或者说路径变更，通过 <code>name</code> 无需调整，但如果通过 <code>path</code>，可能就要修改很多文件里面的链接跳转目标了。</p></li><li><p><code>component</code> 是路由的模板文件，指向一个vue组件，用于指定路由在浏览器端的视图渲染，这里有两种方式来指定使用哪个组件：</p></li></ol><h4 id="同步组件" tabindex="-1"><a class="header-anchor" href="#同步组件" aria-hidden="true">#</a> 同步组件</h4><p>字段 <code>component</code> 接收一个变量，变量的值就是对应的模板组件。</p><p>在打包的时候，会把组件的所有代码都打包到一个文件里，对于大项目来说，这种方式的首屏加载是个灾难，要面对文件过大带来等待时间变长的问题。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">&#39;@/components/home.vue&#39;</span>

<span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Home
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>所以现在都推荐使用第二种方式，可以实现 <strong>路由懒加载</strong> 。</p><h4 id="异步组件" tabindex="-1"><a class="header-anchor" href="#异步组件" aria-hidden="true">#</a> 异步组件</h4><p>字段 <code>component</code> 接收一个函数，在return的时候返回模板组件，同时还可以指定要生成的chunk，组件里的代码都会生成独立的文件，按需引入。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>关于这部分的更多说明，可以查看 <a href="#%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD">路由懒加载</a>。</p><h3 id="多级路由" tabindex="-1"><a class="header-anchor" href="#多级路由" aria-hidden="true">#</a> 多级路由</h3><p>在Vue路由生态里，支持配置二级、三级、四级等多级路由，理论上没有上限，实际业务中用到的级数通常是三级到四级。</p><p>比如你做一个美食类网站，打算在 “中餐” 大分类下配置一个 “饺子” 栏目，那么地址就是：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://chengpeiquan.com/chinese-food/dumplings
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这种情况下，中餐 <code>chinese-food</code> 就是一级路由，饺子 <code>dumplings</code> 就是二级路由。</p><p>如果你想再细化一下，“饺子” 下面再增加一个 “韭菜” 、“白菜” 等不同馅料的子分类：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://chengpeiquan.com/chinese-food/dumplings/chives
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里的韭菜 <code>chives</code> 就是饺子 <code>dumplings</code> 的子路由，也就是三级路由。</p><p>在了解了子路由的概念后，来看一下具体如何配置，以及注意事项。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>父子路由的关系，都是严格按照JSON的层级关系，子路由的信息配置到父级的 <code>children</code> 数组里面，孙路由也是按照一样的格式，配置到子路由的 <code>children</code> 里。</p></div><p>这是一个简单的子路由示范：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 注意：这里是一级路由</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/lv1&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;lv1&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;lv1&quot; */</span> <span class="token string">&#39;@views/lv1.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 注意：这里是二级路由</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">&#39;lv2&#39;</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&#39;lv2&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;lv2&quot; */</span> <span class="token string">&#39;@views/lv2.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 注意：这里是三级路由</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">&#39;lv3&#39;</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">&#39;lv3&#39;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;lv3&quot; */</span> <span class="token string">&#39;@views/lv3.vue&#39;</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>最终线上的访问地址，比如要访问三级路由：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://chengpeiquan.com/lv1/lv2/lv3
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="路由懒加载" tabindex="-1"><a class="header-anchor" href="#路由懒加载" aria-hidden="true">#</a> 路由懒加载</h3><p>在上面我们提过，路由在配置 <a href="#%E5%90%8C%E6%AD%A5%E7%BB%84%E4%BB%B6">同步组件</a> 的时候，构建出来的文件都集中在一起，大的项目的文件会变得非常大，影响页面加载。</p><p>所以Vue在Webpack的代码分割功能的基础上，推出了 <a href="#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6">异步组件</a>，可以把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应组件，这样按需载入，很方便的实现路由组件的懒加载。</p><p>在这一段配置里面：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>起到懒加载配置作用的就是 <code>component</code> 接收的值：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>其中 <code>@views/home.vue</code> 不必说，就是路由的组件。</p><p>而前面的“注释” <code>/* webpackChunkName: &quot;home&quot; */</code> 起到的作用就是为切割后的代码文件命名。</p><p>在命令行对项目执行 <code>npm run build</code> 打包，构建后，会看到控制台输出的打包结果：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>File                                        Size                    Gzipped

dist\static\js\chunk-vendors.1fd4afd3.js    137.27 KiB              48.66 KiB
dist\static\js\login.730a2ef8.js            69.65 KiB               23.06 KiB
dist\static\js\app.82ec2bee.js              4.32 KiB                1.94 KiB
dist\static\js\home.5988a746.js             1.00 KiB                0.54 KiB
dist\static\js\about.a73d5b8f.js            0.38 KiB                0.28 KiB
dist\static\css\login.f107fbdb.css          0.33 KiB                0.19 KiB
dist\static\css\home.12026f88.css           0.13 KiB                0.13 KiB
dist\static\css\app.b1cc4f11.css            0.04 KiB                0.06 KiB
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>而如果你不使用路由懒加载，build出来的文件是这样的：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>File                                        Size                    Gzipped

dist\static\js\chunk-vendors.389391d2.js    203.98 KiB              71.02 KiB
dist\static\js\app.634c584f.js              6.56 KiB                2.40 KiB
dist\static\css\app.beea0177.css            0.41 KiB                0.23 KiB
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>单纯看js文件：</p><p>使用代码切割，当你访问 <code>home</code> 路由的时候，分割后你首次会加载 <code>app</code>、<code>chunk-vendors</code>、<code>home</code> 这3个文件，加起来142.59k。</p><p>而不分割则需要加载210.54k，整整多出接近50%的体积，这只是一个非常小的demo，大型项目会更夸张！</p><p>两者哪个更适合大项目，高下立见！！！</p><h2 id="路由的渲染" tabindex="-1"><a class="header-anchor" href="#路由的渲染" aria-hidden="true">#</a> 路由的渲染</h2><p>所有路由组件，要在访问后进行渲染，都必须在父级组件里带有 <code>&lt;router-view /&gt;</code> 标签。</p><p><code>&lt;router-view /&gt;</code> 在哪里，路由组件的代码就渲染在哪个节点上。</p><p>一级路由的父级组件，当然就是 <code>src</code> 下的 <code>App.vue</code>。</p><p><strong>最基础的配置</strong>：</p><p>最简单的基础格式，就是 <code>template</code> 里面直接就是 <code>&lt;router-view /&gt;</code> ，整个页面就是路由组件。</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>带有全局的公共组件</strong>：</p><p>比如有全站统一的页头、页脚，只有中间区域才是路由。</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 全局页头 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Header</span> <span class="token punctuation">/&gt;</span></span>
  
  <span class="token comment">&lt;!-- 路由 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>

  <span class="token comment">&lt;!-- 全局页脚 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>部分路由全局，部分路由带公共组件</strong>：</p><p>比如大部分页面都需要有侧边栏，但登录页、注册页不能带。</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 登录 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Login</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>route.name === <span class="token punctuation">&#39;</span>login<span class="token punctuation">&#39;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  
  <span class="token comment">&lt;!-- 注册 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Register</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>route.name === <span class="token punctuation">&#39;</span>register<span class="token punctuation">&#39;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

  <span class="token comment">&lt;!-- 带有侧边栏的其他路由 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 固定在左侧的侧边栏 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Sidebar</span> <span class="token punctuation">/&gt;</span></span>
    
    <span class="token comment">&lt;!-- 路由 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="使用-route-获取路由信息-new" tabindex="-1"><a class="header-anchor" href="#使用-route-获取路由信息-new" aria-hidden="true">#</a> 使用 route 获取路由信息{new}</h2><p>和 2.x 可以直接在组件里使用 <code>this.$route</code> 来获取当前路由信息不同，在3.x 的组件里，Vue实例既没有了 <code>this</code>，也没有了 <code>$route</code>。</p><p>要牢记一个事情就是，3.x 用啥都要导入，所以，获取当前路由信息的正确用法是：</p><p><strong>1、导入路由组件</strong></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>2、定义路由变量</strong></p><p>刚刚导入的 <code>useRoute</code> 是一个函数，需要在 <code>setup</code> 里定义一个变量来获取路由信息。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>3、读取路由信息</strong></p><p>接下来就可以通过定义好的变量 <code>route</code> 去获取当前路由信息了。</p><p>当然，如果要在 <code>template</code> 里使用路由，记得把 <code>route</code> 在 <code>setup</code> 里return出去。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 获取路由名称</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取路由参数</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>3.x 的 <code>route</code> 和 2.x 的用法基本一致，日常使用应该很快能上手。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>但是 3.x 的新路由也有一些小变化，有一些属性是被移除了，比如之前获取父级路由信息，很喜欢用的 <code>parent</code> 属性，现在已经没有了 <a href="https://next.router.vuejs.org/guide/migration/index.html#passing-content-to-route-components-slot" target="_blank" rel="noopener noreferrer">点击查看原因<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 。</p></div><p>类似被移除的 <code>parent</code> ，如果要获取父级路由信息（比如你在做面包屑功能的时候），可以改成下面这样，手动指定倒数第二个为父级信息：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 获取路由记录</span>
<span class="token keyword">const</span> <span class="token constant">MATCHED</span> <span class="token operator">=</span> route<span class="token punctuation">.</span>matched<span class="token punctuation">;</span>

<span class="token comment">// 获取该记录的路由个数</span>
<span class="token keyword">const</span> <span class="token constant">LEN</span> <span class="token operator">=</span> <span class="token constant">MATCHED</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token comment">// 获取倒数第二个路由（也就是当前路由的父级路由）</span>
<span class="token keyword">const</span> <span class="token constant">ROUTE_PARENT</span> <span class="token operator">=</span> <span class="token constant">MATCHED</span><span class="token punctuation">[</span><span class="token constant">LEN</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果有配置父级路由，那么刚刚的 <code>ROUTE_PARENT</code> 就是父级路由信息了</p><h2 id="使用-router-操作路由-new" tabindex="-1"><a class="header-anchor" href="#使用-router-操作路由-new" aria-hidden="true">#</a> 使用 router 操作路由{new}</h2><p>和 <code>route</code> 一样，在 3.x 也不再存在 <code>this.$router</code> ，也必须通过导入路由组件来使用。</p><p><strong>1、导入路由组件</strong></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>2、定义路由变量</strong></p><p>和 <code>useRoute</code> 一样， <code>useRouter</code> 也是一个函数，需要在 <code>setup</code> 里定义一个变量来获取路由信息。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>3、操作路由</strong></p><p>接下来就可以通过定义好的变量 <code>router</code> 去操作路由了。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 跳转首页</span>
router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 返回上一页</span>
router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="使用-router-link-标签跳转" tabindex="-1"><a class="header-anchor" href="#使用-router-link-标签跳转" aria-hidden="true">#</a> 使用 router-link 标签跳转</h2><p><code>router-link</code> 是一个路由组件，可直接在 <code>template</code> 里使用，基础的用法在 2.x 和 3.x 一样。</p><p>默认会被转换为一个 <code>a</code> 标签，对比写死的 <code>&lt;a href=&quot;...&quot;&gt;</code> ，使用 <code>router-link</code> 会更加灵活。</p><h3 id="基础跳转" tabindex="-1"><a class="header-anchor" href="#基础跳转" aria-hidden="true">#</a> 基础跳转</h3><p>最基础的用法就是把它当成一个 <code>target=&quot;_self&quot;</code> 的a标签使用，但无需重新刷新页面，因为是路由跳转，它的体验和使用 <code>router</code> 去进行路由导航的效果完全一样。</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>等价于 <code>router</code> 的 <code>push</code>：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你可以写个 <code>span</code> 然后绑定 <code>click</code> 事件来达到 <code>router-link</code> 的效果（但你看是不是麻烦很多emm…</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>link<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>router.push({
      name: <span class="token punctuation">&#39;</span>home<span class="token punctuation">&#39;</span>
    })<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    首页
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="带参数的跳转" tabindex="-1"><a class="header-anchor" href="#带参数的跳转" aria-hidden="true">#</a> 带参数的跳转</h3><p>使用 <code>router</code> 的时候，可以轻松的带上参数去那些有id的内容页、用户资料页、栏目列表页等等。</p><p>比如你要访问一篇文章 <code>https://chengpeiquan.com/article/123</code> ，用 <code>push</code> 的写法是：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;article&#39;</span><span class="token punctuation">,</span>
  params<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">123</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>同理，从基础跳转的写法，很容易就能get到在 <code>router-link</code> 里应该怎么写：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>link<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
      name: <span class="token punctuation">&#39;</span>article<span class="token punctuation">&#39;</span>,
      params: {
        id: 123
      }
    }<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    这是文章的标题
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="不生成-a-标签-new" tabindex="-1"><a class="header-anchor" href="#不生成-a-标签-new" aria-hidden="true">#</a> 不生成 a 标签{new}</h3><p><code>router-link</code> 默认是被转换为一个 <code>a</code> 标签，但根据业务场景，你也可以把它指定为生成其他标签，比如 <code>span</code> 、 <code>div</code> 、 <code>li</code> 等等，这些标签因为不具备 <code>href</code> 属性，所以在跳转时都是通过 <code>click</code> 事件去执行。</p><p>在 2.x，指定为其他标签只需要一个 <code>tag</code> 属性即可：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>span<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>但在 3.x ，<code>tag</code> 属性已被移除，需要通过 <code>custom</code> 和 <code>v-slot</code> 的配合来渲染为其他标签。</p><p>比如要渲染为一个带有路由导航功能的 <code>div</code>：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span>
    <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">custom</span>
    <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ navigate }<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>link<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navigate<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
      首页
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>渲染后就是一个普通的 <code>span</code> 标签，当你点击的时候，它会通过路由的导航把你带到指定的路由页：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>关于这2个属性，他们的参数说明如下：</p><ol><li><p><code>custom</code> ，一个布尔值，用于控制是否需要渲染为 <code>a</code> 标签，当不包含 <code>custom</code> 或者把 <code>custom</code> 设置为 <code>false</code> 时，则依然使用 <code>a</code> 标签渲染。</p></li><li><p><code>v-slot</code> 是一个对象，用来决定标签的行为，它包含了：</p></li></ol><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">href</td><td style="text-align:left;">解析后的URL，将会作为一个 <code>a</code> 元素的 <code>href</code> 属性</td></tr><tr><td style="text-align:left;">route</td><td style="text-align:left;">解析后的规范化的地址</td></tr><tr><td style="text-align:left;">navigate</td><td style="text-align:left;">触发导航的函数，会在必要时自动阻止事件，和 <code>router-link</code> 同理</td></tr><tr><td style="text-align:left;">isActive</td><td style="text-align:left;">如果需要应用激活的 <code>class</code> 则为 <code>true</code>，允许应用一个任意的 <code>class</code></td></tr><tr><td style="text-align:left;">isExactActive</td><td style="text-align:left;">如果需要应用精确激活的 <code>class</code> 则为 <code>true</code>，允许应用一个任意的 <code>class</code></td></tr></tbody></table><p>一般来说，<code>v-slot</code> 必备的只有 <code>navigate</code> ，用来绑定元素的点击事件，否则元素点击后不会有任何反应，其他的可以根据实际需求来添加。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>要渲染为非 <code>a</code> 标签，切记两个点：</p><ol><li><p><code>router-link</code> 必须带上 <code>custom</code> 和 <code>v-slot</code> 属性</p></li><li><p>最终要渲染的标签，写在 <code>router-link</code> 里，包括对应的 <code>className</code> 和点击事件</p></li></ol></div><h2 id="在独立-ts-js-文件里使用路由" tabindex="-1"><a class="header-anchor" href="#在独立-ts-js-文件里使用路由" aria-hidden="true">#</a> 在独立 TS/JS 文件里使用路由</h2><p>除了可以在 <code>.vue</code> 文件里使用路由之外，你也可以在单独的 <code>.ts</code>、<code>.js</code> 里使用。</p><p>比如你要做一个带有用户系统的站点，登录的相关代码除了在 <code>login.vue</code> 里运用外，在注册页面 <code>register.vue</code>，用户注册成功还要帮用户执行一次自动登录。</p><p>登录完成还要记录用户的登录信息、token、过期时间等等，有不少数据要做处理，以及需要帮助用户自动切去他登录前的页面等行为。</p><p>这是两个不同的组件，让我来写2次几乎一样的代码，我是拒绝的！</p><p>这种情况下你就可以通过抽离核心代码，封装成一个 <code>login.ts</code> 文件，在这个独立的 <code>ts</code> 文件里去操作路由。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 导入路由</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;@/router&#39;</span>

<span class="token comment">// 执行路由跳转</span>
router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="路由元信息配置" tabindex="-1"><a class="header-anchor" href="#路由元信息配置" aria-hidden="true">#</a> 路由元信息配置</h2><p>有时候你的项目需要一些个性化配置，比如：</p><ol><li><p>每个路由给予独立的标题；</p></li><li><p>管理后台的路由，部分页面需要限制一些访问权限；</p></li><li><p>通过路由来自动生成侧边栏、面包屑；</p></li><li><p>部分路由的生命周期需要做缓存（keep alive）;</p></li><li><p>and so on……</p></li></ol><p>无需维护很多套配置，<strong>定义路由的时候可以配置 meta 字段</strong>，比如下面就是包含了多种元信息的一个登录路由：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;login&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;login&quot; */</span> <span class="token string">&#39;@views/login.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&#39;登录&#39;</span><span class="token punctuation">,</span>
      isDisableBreadcrumbLink<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      isShowBreadcrumb<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      addToSidebar<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      sidebarIcon<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      sidebarIconAlt<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      isNoLogin<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这个是我在做后台的时候的一些配置，主要的功能是：</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">类型</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">title</td><td style="text-align:left;">String</td><td style="text-align:left;">用于在渲染的时候配置浏览器标题；</td></tr><tr><td style="text-align:left;">isDisableBreadcrumbLink</td><td style="text-align:left;">Boolean</td><td style="text-align:left;">是否禁用面包屑链接（对一些没有内容的路由可以屏蔽访问）；</td></tr><tr><td style="text-align:left;">isShowBreadcrumb</td><td style="text-align:left;">Boolean</td><td style="text-align:left;">是否显示面包屑（此处的登录页不需要面包屑）；</td></tr><tr><td style="text-align:left;">addToSidebar</td><td style="text-align:left;">Boolean</td><td style="text-align:left;">是否加入侧边栏（此处的登录页不需要加入侧边栏）；</td></tr><tr><td style="text-align:left;">sidebarIcon</td><td style="text-align:left;">String</td><td style="text-align:left;">配置侧边栏的图标className（默认）；</td></tr><tr><td style="text-align:left;">sidebarIconAlt</td><td style="text-align:left;">String</td><td style="text-align:left;">配置侧边栏的图标className（展开状态）；</td></tr><tr><td style="text-align:left;">isNoLogin</td><td style="text-align:left;">Boolean</td><td style="text-align:left;">是否免登录（设置为true后，会校验登录状态，此处的登录页不需要校验）；</td></tr></tbody></table><p>这些功能都是我在项目里需要操控到路由的功能，通过这样的一些字段来达到路由的控制。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>路由 <code>meta</code> 字段的内容没有要求，按需配置，一些功能可以配合 <a href="#%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA">路由拦截</a> 一起使用。</p></div><p>类似的，你如果有其他需求，比如要增加对不同用户组的权限控制（比如有管理员、普通用户分组，部分页面只有管理员允许访问），都可以通过路由元信息来配置，然后在对应的地方进行读取操作。</p><h2 id="路由重定向" tabindex="-1"><a class="header-anchor" href="#路由重定向" aria-hidden="true">#</a> 路由重定向</h2><p>这个是我们的老朋友了，路由重定向是使用一个 <code>redirect</code> 字段，配置到对应的路由里面去实现跳转。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>通常来说，配置了 <code>redirect</code> 的路由，只需要指定2个字段即可，1个是 <code>path</code> 自己的路径，1个是 <code>redirect</code> 目标路由的路径，其他诸如 <code>name</code>、<code>component</code> 等字段可以忽略，因为根本不会访问到。</p></div><p><code>redirect</code> 字段可以接收三种类型的值：</p><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">填写的值</th></tr></thead><tbody><tr><td style="text-align:left;">string</td><td style="text-align:left;">另外一个路由的 <code>path</code></td></tr><tr><td style="text-align:left;">route</td><td style="text-align:left;">另外一个路由（类似 <code>router.push</code>）</td></tr><tr><td style="text-align:left;">function</td><td style="text-align:left;">可以判断不同情况的重定向目标，最终 <code>return</code> 一个 <code>path</code> 或者 <code>route</code></td></tr></tbody></table><h3 id="业务场景" tabindex="-1"><a class="header-anchor" href="#业务场景" aria-hidden="true">#</a> 业务场景</h3><p>路由重定向可以避免用户访问到一些无效路由页面：</p><ol><li><p>比如项目上线了一段时间后，有个路由需要改名，或者调整路径层级，可以把旧路由重定向到新的，避免原来的用户从收藏夹等地方进来后找不到</p></li><li><p>一些容易打错的地址，比如通常个人资料页都是用 <code>profile</code>，但是你的这个网站是用 <code>account</code>，那也可以把 <code>profile</code> 重定向到 <code>account</code> 去</p></li><li><p>对于一些有会员体系的站点，可以根据用户权限进行重定向，分别指向他们具备访问权限的页面</p></li><li><p>官网首页在PC端、移动端、游戏内嵌横屏版分别有3套页面，但希望能通过主域名来识别不同设备，帮助用户自动切换访问</p></li></ol><p>了解了业务场景，接下来就能比较清晰的了解应该如何配置重定向了。</p><h3 id="配置为-path" tabindex="-1"><a class="header-anchor" href="#配置为-path" aria-hidden="true">#</a> 配置为 path</h3><p>最常用的场景，恐怕就是首页的指向了，比如首页地址是 <code>https://chengpeiquan.com/home</code>，但是想让主域名 <code>https://chengpeiquan.com/</code> 也能跳转到 <code>/home</code>，可以这么配置：</p><p>这是最简单的配置方式，把目标路由的 <code>path</code> 丢进来就可以了：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 重定向到home</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 真正的首页</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>但缺点也显而易见，只能针对那些不带参数的路由。</p><h3 id="配置为-route" tabindex="-1"><a class="header-anchor" href="#配置为-route" aria-hidden="true">#</a> 配置为 route</h3><p>如果你想要重定向后的路由地址带上一些参数，可以配置为 <code>route</code>：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 重定向到home，并带上一个query</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{</span>
        from<span class="token operator">:</span> <span class="token string">&#39;redirect&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 真正的首页</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>最终访问的地址就是 <code>https://chengpeiquan.com/home?from=redirect</code>， 像这样带有来路参数的，你就可以在 “百度统计” 或者 “CNZZ统计” 之类的统计站点查看来路的流量。</p><h3 id="配置为-function" tabindex="-1"><a class="header-anchor" href="#配置为-function" aria-hidden="true">#</a> 配置为 function</h3><p>结合业务场景来解释是最直观的，比如你的网站有3个用户组，一个是管理员，一个是普通用户，还有一个是游客（未登录），他们的网站首页是不一样的。</p><p>管理员的首页具备各种数据可视化图表、最新的网站数据、一些最新的用户消息等等。</p><p>普通用户的首页可能只有一些常用模块的入口链接。</p><p>未登录用户则直接跳转到登录页面。</p><p>产品需要在访问网站主域名的时候，识别他们的身份来跳转不同的首页，那么就可以来配置我们的路由重定向了：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 访问主域名时，根据用户的登录信息，重定向到不同的页面</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">redirect</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// LOGIN_INFO是当前用户的登录信息，你可以从localStorage或者Vuex读取</span>
      <span class="token keyword">const</span> <span class="token constant">GROUP_ID</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token constant">LOGIN_INFO</span><span class="token punctuation">.</span>groupId<span class="token punctuation">;</span>

      <span class="token comment">// 根据组别id进行跳转</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token constant">GROUP_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 管理员，跳去仪表盘</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token string">&#39;/dashboard&#39;</span><span class="token punctuation">;</span>

        <span class="token comment">// 普通用户，跳去首页</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">;</span>

        <span class="token comment">// 其他都认为未登录，跳去登录页</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token string">&#39;/login&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="路由别名配置" tabindex="-1"><a class="header-anchor" href="#路由别名配置" aria-hidden="true">#</a> 路由别名配置</h2><p>根据你的业务需求，你也可以为路由指定一个别名，与上面的 <a href="#%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91">路由重定向</a> 功能相似，但又有不同：</p><p>配置了路由重定向，当用户访问 <code>/a</code> 时，URL 将会被替换成 <code>/b</code>，然后匹配的实际路由是 <code>/b</code> 。</p><p>配置了路由别名，<code>/a</code> 的别名是 <code>/b</code>，当用户访问 <code>/b</code> 时，URL 会保持为 <code>/b</code>，但是路由匹配则为 <code>/a</code>，就像用户访问 <code>/a</code> 一样。</p><p><strong>配置方法</strong></p><p>添加一个 <code>alias</code> 字段即可轻松实现：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token string">&#39;/index&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如上的配置，即可实现可以通过 <code>/home</code> 访问首页，也可以通过 <code>/index</code> 访问首页。</p><h2 id="_404路由页面配置-new" tabindex="-1"><a class="header-anchor" href="#_404路由页面配置-new" aria-hidden="true">#</a> 404路由页面配置{new}</h2><p>你可以配置一个404路由来代替站内的404页面。</p><p><strong>配置方法</strong></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/:pathMatch(.*)*&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;404&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;404&quot; */</span> <span class="token string">&#39;@views/404.vue&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这样配置之后，只要访问到不存在的路由，就会显示为这个404模板。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>新版的路由不再支持直接配置通配符 <code>*</code> ，而是必须使用带有自定义正则表达式的参数进行定义。</p><p>官方说明：<a href="https://next.router.vuejs.org/guide/migration/#removed-star-or-catch-all-routes" target="_blank" rel="noopener noreferrer">Removed * (star or catch all) routes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><h2 id="导航守卫" tabindex="-1"><a class="header-anchor" href="#导航守卫" aria-hidden="true">#</a> 导航守卫</h2><p>和 2.x 时使用的路由一样， 3.x 也支持导航守卫，并且用法基本上是一样的。</p><p>导航守卫这个词对初次接触的同学来说应该会有点云里雾里，其实就是几个专属的钩子函数，我们先来看一下使用场景，大致理解一下这个东西是啥，有什么用。</p><h3 id="钩子的应用场景" tabindex="-1"><a class="header-anchor" href="#钩子的应用场景" aria-hidden="true">#</a> 钩子的应用场景</h3><p>对于导航守卫还不熟悉的同学，可以从一些实际使用场景来加强印象，比如：</p><ol><li><p>前面说的，在渲染的时候配置浏览器标题，Vue项目只要一个Html文件，默认只有一个标题，但你想在访问 <code>home</code> 的时候标题显示为 “首页”，访问 <code>about</code> 的时候标题显示为 “关于我们”；</p></li><li><p>部分页面需要管理员才能访问，普通用户不允许进入到该路由页面；</p></li><li><p>Vue单页面项目，传统的CNZZ/百度统计等网站统计代码只会在页面加载的时候统计一次，但你需要每次切换路由都上报一次PV数据</p></li></ol><p>场景，还有很多…</p><p>导航守卫支持全局使用，也可以在 <code>.vue</code> 文件里单独使用，我们来看下具体的用法。</p><h3 id="路由里的全局钩子" tabindex="-1"><a class="header-anchor" href="#路由里的全局钩子" aria-hidden="true">#</a> 路由里的全局钩子</h3><p>顾名思义，是在创建 <code>router</code> 的时候进行全局的配置，也就是说，只要你配置了钩子，那么所有的路由在调用到的时候，都会触发这些钩子函数。</p><table><thead><tr><th style="text-align:left;">可用钩子</th><th style="text-align:left;">含义</th><th style="text-align:left;">触发时机</th></tr></thead><tbody><tr><td style="text-align:left;">beforeEach</td><td style="text-align:left;">全局前置守卫</td><td style="text-align:left;">在路由跳转前触发</td></tr><tr><td style="text-align:left;">beforeResolve</td><td style="text-align:left;">全局解析守卫</td><td style="text-align:left;">在导航被确认前，同时在组件内守卫和异步路由组件被解析后</td></tr><tr><td style="text-align:left;">afterEach</td><td style="text-align:left;">全局后置守卫</td><td style="text-align:left;">在路由跳转完成后触发</td></tr></tbody></table><p>全局配置非常简单，在 <code>src/router/index.ts</code> 里，创建路由之后、在暴露出去之前使用：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token comment">// 创建路由</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在这里调用导航守卫的钩子函数</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 暴露出去</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="beforeeach-new" tabindex="-1"><a class="header-anchor" href="#beforeeach-new" aria-hidden="true">#</a> beforeEach{new}</h3><p>全局前置守卫，这是导航守卫里面运用的最多的一个钩子函数，我习惯把它叫成 “路由拦截”。</p><p>拦截这个词，顾名思义，就是在 XXX 目的达到之前，把它拦下来，所以路由的目的就是渲染指定的组件嘛，路由拦截就是在它渲染之前，做一些拦截操作。</p><p><strong>参数</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">to</td><td style="text-align:left;">即将要进入的路由对象</td></tr><tr><td style="text-align:left;">from</td><td style="text-align:left;">当前导航正要离开的路由</td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>和 2.x 不同，2.x 的 <code>beforeEach</code> 是默认三个参数，第三个参数是 <code>next</code>，用来操作路由接下来的跳转。</p><p>但在新版本路由里，已经通过 RFC 将其删除，虽然目前还是作为可选参数使用，但以后不确定是否会移除，不建议继续使用，<a href="https://github.com/vuejs/rfcs/blob/master/active-rfcs/0037-router-return-guards.md#motivation" target="_blank" rel="noopener noreferrer">点击查看原因<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>新版本路由可以通过 <code>return</code> 来代替 <code>next</code>。</p></div><p><strong>用法</strong></p><p>比如在进入路由之前，根据 <code>meta</code> 信息，设定路由的网页标题：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">TITLE</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token constant">TITLE</span> <span class="token operator">||</span> <span class="token string">&#39;默认title&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>或者判断是否需要登录（需要在 <a href="#%E8%B7%AF%E7%94%B1%E5%85%83%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE">meta信息</a> 里配置相关的参数）：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> to<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>isNoLogin <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>或者针对一些需要id参数，但参数丢失的路由做拦截：</p><p>比如：文章详情页 <code>https://chengpeiquan/article/123</code> 这样的地址，是需要带有文章id的，如果只访问 <code>https://chengpeiquan/article</code> 则需要拦截掉。</p><p>这里是关于 <code>article</code> 路由的配置，是有要求params要带上id参数：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 这是一个配置了params，访问的时候必须带id的路由</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/article/:id&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;article&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;article&quot; */</span> <span class="token string">&#39;@views/article.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>当路由的 <code>params</code> 丢失的时候，路由记录 <code>matched</code> 是一个空数组，针对这样的情况，你就可以配置一个拦截，丢失参数时返回首页：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="beforeresolve" tabindex="-1"><a class="header-anchor" href="#beforeresolve" aria-hidden="true">#</a> beforeResolve</h3><p>全局解析守卫，它会在每次导航时触发，但是在所有组件内守卫和异步路由组件被解析之后，将在确认导航之前被调用。</p><p>这个钩子用的比较少，因为它和 <code>beforeEach</code> 非常相似，相信大部分同学都是会用 <code>beforeEach</code> 来代替它。</p><p>那么它有什么用？</p><p>它通常会用在一些申请权限的环节，比如一些H5页面需要申请系统相机权限、一些微信活动需要申请微信的登录信息授权，获得权限之后才允许获取接口数据和给用户更多的操作，使用 <code>beforeEach</code> 时机太早，使用 <code>afterEach</code> 又有点晚，那么这个钩子的时机就刚刚好。</p><p><strong>参数</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">to</td><td style="text-align:left;">即将要进入的路由对象</td></tr><tr><td style="text-align:left;">from</td><td style="text-align:left;">当前导航正要离开的路由</td></tr></tbody></table><p><strong>用法</strong></p><p>我就拿目前英文官网的一个申请照相机权限的例子来举例（<a href="https://next.router.vuejs.org/guide/advanced/navigation-guards.html#global-resolve-guards" target="_blank" rel="noopener noreferrer">官网传送门<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">beforeResolve</span><span class="token punctuation">(</span><span class="token keyword">async</span> to <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果路由配置了必须调用相机权限</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requiresCamera <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 正常流程，咨询是否允许使用照相机</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">askForCameraPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 容错</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> error <span class="token keyword">instanceof</span> <span class="token class-name">NotAllowedError</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ... 处理错误，然后取消导航</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果出现意外，则取消导航并抛出错误</span>
        <span class="token keyword">throw</span> error
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="aftereach" tabindex="-1"><a class="header-anchor" href="#aftereach" aria-hidden="true">#</a> afterEach</h3><p>全局后置守卫，这也是导航守卫里面用的比较多的一个钩子函数。</p><p><strong>参数</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">to</td><td style="text-align:left;">即将要进入的路由对象</td></tr><tr><td style="text-align:left;">from</td><td style="text-align:left;">当前导航正要离开的路由</td></tr></tbody></table><p><strong>用法</strong></p><p>在刚刚的 <a href="#%E9%92%A9%E5%AD%90%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">钩子的应用场景</a> 里面我有个例子，就是每次切换路由都上报一次PV数据，类似这种每个路由都要执行一次，但又不必在渲染前操作的，都可以放到后置钩子里去执行。</p><p>我之前有写过2个插件：<a href="https://www.npmjs.com/package/vue-cnzz-analytics" target="_blank" rel="noopener noreferrer">Vue版CNZZ统计<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://www.npmjs.com/package/vue-baidu-analytics" target="_blank" rel="noopener noreferrer">Vue版百度统计<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，就是用的这个后置钩子来实现自动上报数据。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 上报流量的操作</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="在组件内使用全局钩子" tabindex="-1"><a class="header-anchor" href="#在组件内使用全局钩子" aria-hidden="true">#</a> 在组件内使用全局钩子</h3><p>上面所讲的都是全局钩子，虽然一般都是在路由文件里使用，但如果有需要，也可以在 <code>.vue</code> 文件里操作。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>和路由的渲染不同，渲染是父级路由组件必须带有 <code>&lt;router-view /&gt;</code> 标签才能渲染，但是使用全局钩子不受此限制。</p><p>建议只在一些入口文件里使用，比如 <code>App.vue</code> ，或者是一些全局的 <code>Header.vue</code>、<code>Footer.vue</code> 里使用，方便后续维护。</p></div><p>在 <code>setup</code> 里，定义一个 <code>router</code> 变量获取路由之后，就可以操作了：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 定义路由</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用全局钩子</span>
    router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="路由里的独享钩子" tabindex="-1"><a class="header-anchor" href="#路由里的独享钩子" aria-hidden="true">#</a> 路由里的独享钩子</h3><p>介绍完全局钩子，如果你只是有个别路由要做处理，你可以使用 <strong>路由独享的守卫</strong> ，用来针对个别路由定制一些特殊功能，可以减少在全局钩子里面写一堆判断。</p><table><thead><tr><th style="text-align:left;">可用钩子</th><th style="text-align:left;">含义</th><th style="text-align:left;">触发时机</th></tr></thead><tbody><tr><td style="text-align:left;">beforeEnter</td><td style="text-align:left;">路由独享前置守卫</td><td style="text-align:left;">在路由跳转前触发</td></tr></tbody></table><p>注：路由独享的钩子，必须配置在 <code>routes</code> 的JSON树里面，挂在对应的路由下面（与 <code>path</code>、 <code>name</code>、<code>meta</code> 这些字段同级）。</p><h3 id="beforeenter-new" tabindex="-1"><a class="header-anchor" href="#beforeenter-new" aria-hidden="true">#</a> beforeEnter{new}</h3><p>它和全局钩子 <code>beforeEach</code> 的作用相同，都是在进入路由之前触发，触发时机比 <code>beforeResolve</code> 要早。</p><p>顺序：<code>beforeEach</code>（全局） &gt; <code>beforeEnter</code>（独享） &gt; <code>beforeResolve</code>（全局）。</p><p><strong>参数</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">to</td><td style="text-align:left;">即将要进入的路由对象</td></tr><tr><td style="text-align:left;">from</td><td style="text-align:left;">当前导航正要离开的路由</td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>和 <code>beforeEach</code> 一样，也是取消了 <code>next</code>，可以通过 <code>return</code> 来代替。</p></div><p><strong>用法</strong></p><p>比如：整个站点的默认标题都是 “项目经验 - 程沛权” 这样，以 “栏目标题” + “全站关键标题” 的格式作为网页的title，但在首页的时候，你想做一些不一样的定制。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;home&quot; */</span> <span class="token string">&#39;@views/home.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 在这里添加单独的路由守卫</span>
    <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&#39;程沛权 - 养了三只猫&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>你就可以通过 <code>beforeEnter</code> 来实现一些个别路由的单独定制。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>需要注意的是，只有从不同的路由切换进来，才会触发该钩子。</p><p>针对同一个路由，但是不同的params或者query、hash，都不会重复触发该钩子。</p><p>比如从 <code>https://chengpeiquan.com/article/123</code> 切换到 <code>https://chengpeiquan.com/article/234</code> 是不会触发的。</p></div><p>其他的用法和 <code>beforeEach</code> 可以说是一样的。</p><h3 id="组件内单独使用-new" tabindex="-1"><a class="header-anchor" href="#组件内单独使用-new" aria-hidden="true">#</a> 组件内单独使用{new}</h3><p>组件里除了可以使用全局钩子外，还可以使用组件专属的路由钩子。</p><table><thead><tr><th style="text-align:left;">可用钩子</th><th style="text-align:left;">含义</th><th style="text-align:left;">触发时机</th></tr></thead><tbody><tr><td style="text-align:left;">onBeforeRouteUpdate</td><td style="text-align:left;">组件内的更新守卫</td><td style="text-align:left;">在当前路由改变，但是该组件被复用时调用</td></tr><tr><td style="text-align:left;">onBeforeRouteLeave</td><td style="text-align:left;">组件内的离开守卫</td><td style="text-align:left;">导航离开该组件的对应路由时调用</td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>1、组件内钩子的入参，也都是取消了 <code>next</code>，可以通过 <code>return</code> 来代替。</p><p>2、在 <code>setup</code> 里使用时，需要遵循 <code>Vue 3.0</code> 的规范要求，先 <code>import</code> 再操作。</p></div><p>和旧版路由不同，新版的 <code>composition api</code> 移除了 <code>beforeRouteEnter</code> 这个钩子了（<a href="https://next.router.vuejs.org/guide/advanced/composition-api.html#accessing-the-router-and-current-route-inside-setup" target="_blank" rel="noopener noreferrer">查看详情<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）</p><h3 id="onbeforerouteupdate-new" tabindex="-1"><a class="header-anchor" href="#onbeforerouteupdate-new" aria-hidden="true">#</a> onBeforeRouteUpdate{new}</h3><p>可以在当前路由改变，但是该组件被复用时，重新调用里面的一些函数用来更新模板数据的渲染。</p><p><strong>参数</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">to</td><td style="text-align:left;">即将要进入的路由对象</td></tr><tr><td style="text-align:left;">from</td><td style="text-align:left;">当前导航正要离开的路由</td></tr></tbody></table><p><strong>用法</strong></p><p>比如一个内容网站，通常在文章详情页底部会有相关阅读推荐，这个时候就会有一个操作场景是，从文章A跳转到文章B。</p><p>比如从 <code>https://chengpeiquan.com/article/111</code> 切去 <code>https://chengpeiquan.com/article/222</code> ，这种情况就属于 “路由改变，但是组件被复用” 的情况了。</p><p>这种情况下，原本放在 <code>onMounted</code> 里执行数据请求的函数就不会被调用，可以借助该钩子来实现渲染新的文章内容。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute<span class="token punctuation">,</span> onBeforeRouteUpdate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取文章详情</span>
    <span class="token keyword">const</span> getArticleDetail <span class="token operator">=</span> <span class="token punctuation">(</span>articleId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 请求文章内容</span>
      <span class="token comment">// 此处略...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 组件挂载完成后执行文章内容的请求</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">ARTICLE_ID</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token constant">ARTICLE_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 组件被复用时重新请求新的文章内容（注意：要获取的是to的params）</span>
    <span class="token function">onBeforeRouteUpdate</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">NEW_ARTICLE_ID</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token constant">NEW_ARTICLE_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="onbeforerouteleave-new" tabindex="-1"><a class="header-anchor" href="#onbeforerouteleave-new" aria-hidden="true">#</a> onBeforeRouteLeave{new}</h3><p>可以在离开当前路由之前，实现一些离开前的判断拦截。</p><p><strong>参数</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">to</td><td style="text-align:left;">即将要进入的路由对象</td></tr><tr><td style="text-align:left;">from</td><td style="text-align:left;">当前导航正要离开的路由</td></tr></tbody></table><p><strong>用法</strong></p><p>这个离开守卫通常用来禁止用户在还未保存修改前突然离开，可以通过 <code>return false</code> 来取消用户离开当前路由。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onBeforeRouteLeave <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 调用离开守卫</span>
    <span class="token function">onBeforeRouteLeave</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// 弹出一个确认框</span>
      <span class="token keyword">const</span> <span class="token constant">CONFIRM_TEXT</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;确认要离开吗？您的更改尚未保存！&#39;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token constant">IS_CONFIRM_LEAVE</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 当用户点取消时，不离开路由</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token constant">IS_CONFIRM_LEAVE</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="路由监听" tabindex="-1"><a class="header-anchor" href="#路由监听" aria-hidden="true">#</a> 路由监听</h2><p>路由的监听，可以延续以往的 <code>watch</code> 大法，也可以用全新的 <code>watchEffect</code>。</p><h3 id="watch-new" tabindex="-1"><a class="header-anchor" href="#watch-new" aria-hidden="true">#</a> watch{new}</h3><p>在 <code>Vue 2</code> 的时候，监听路由变化用的最多的就是 <code>watch</code> 了，<code>Vue 3</code> 的 <code>watch</code> 使用更简单。</p><p><strong>1. 监听整个路由</strong></p><p>你可以跟以前一样，直接监听整个路由的变化：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听整个路由</span>
    <span class="token function">watch</span><span class="token punctuation">(</span> route<span class="token punctuation">,</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理一些事情</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>第一个参数传入整个路由；</p><p>第二个参数是个callback，可以获取to和from来判断路由变化情况。</p><p><strong>2. 监听路由的某个数据</strong></p><p>如果只想监听路由的某个数据变化，比如监听一个 <code>query</code>，或者一个 <code>param</code>，你可以采用这种方式：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听路由参数的变化</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;监听到query变化&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>第一个参数传入一个函数，<code>return</code> 你要监听的值；</p><p>第二个参数是个callback，可以针对参数变化进行一些操作。</p><h3 id="watcheffect-new" tabindex="-1"><a class="header-anchor" href="#watcheffect-new" aria-hidden="true">#</a> watchEffect{new}</h3><p>这是 <code>Vue 3</code> 新出的一个监听函数，可以简化 <code>watch</code> 的行为。</p><p>比如你定义了一个函数，通过路由的参数来获取文章id，然后请求文章内容：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取文章详情</span>
    <span class="token keyword">const</span> getArticleDetail <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 直接通过路由的参数来获取文章id</span>
      <span class="token keyword">const</span> <span class="token constant">ARTICLE_ID</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;文章id是：&#39;</span><span class="token punctuation">,</span> <span class="token constant">ARTICLE_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// 请求文章内容</span>
      <span class="token comment">// 此处略...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 直接监听包含路由参数的那个函数</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span>getArticleDetail<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>对比 <code>watch</code> 的使用， <code>watchEffect</code> 在操作上更加简单，把包含要被监听数据的函数，当成它的入参丢进去即可。</p><h2 id="部署问题与服务端配置" tabindex="-1"><a class="header-anchor" href="#部署问题与服务端配置" aria-hidden="true">#</a> 部署问题与服务端配置</h2><p>通常使用路由的 Hash 模式，部署后有问题的情况很少，但是如果使用 History 模式，你可能会遇到这样那样的问题。</p><h3 id="常见部署问题" tabindex="-1"><a class="header-anchor" href="#常见部署问题" aria-hidden="true">#</a> 常见部署问题</h3><p>这里整理一些常见部署问题的原因分析和解决方案，可作参考。</p><h4 id="页面刷新就-404" tabindex="-1"><a class="header-anchor" href="#页面刷新就-404" aria-hidden="true">#</a> 页面刷新就 404</h4><p>页面部署到服务端之后，访问首页正常；通过导航上面的链接进行路由跳转，也正常；但是刷新页面就变成 404 了。</p><h5 id="问题原因" tabindex="-1"><a class="header-anchor" href="#问题原因" aria-hidden="true">#</a> 问题原因</h5><p>一般这种情况是路由开启了 History 模式，但是服务端没有配置功能支持。</p><h5 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h5><p>请根据 <a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE">服务端配置</a> 部分的说明，与你的运维同事沟通，让他帮忙修改服务端的配置。</p><h4 id="部分路由白屏" tabindex="-1"><a class="header-anchor" href="#部分路由白屏" aria-hidden="true">#</a> 部分路由白屏</h4><p>如果你在项目配置文件里，把里面的 <a href="https://cli.vuejs.org/zh/config/#publicpath" target="_blank" rel="noopener noreferrer">publicPath<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （使用 Vue CLI ） 或者 <a href="https://cn.vitejs.dev/config/#base" target="_blank" rel="noopener noreferrer">base<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （使用 Vite ） 配置成相对路径 <code>./</code> ，但是路由配置了二级或以上，那么就会出现这个问题。</p><h5 id="问题原因-1" tabindex="-1"><a class="header-anchor" href="#问题原因-1" aria-hidden="true">#</a> 问题原因</h5><p>原因是打包后的 JS 、 CSS 等静态资源都是存放在项目根目录下，一级路由的 <code>./</code> 就是根目录，所以访问正常；而二级路由的 <code>./</code> 则不是根目录了，是从当前目录载入的 ，这就导致无法正确载入 JS 文件，从而导致了白屏。</p><p>假设项目域名是 <code>https://example.com</code> ，那么：</p><ul><li>一级路由是 <code>https://example.com/home</code></li><li>二级路由是 <code>https://example.com/foo/bar</code></li><li>假设打包后的 JS 文件等静态资产存放于 <code>https://example.com/assets/</code> 文件夹下</li></ul><p>访问一级路由时， <code>./</code> 访问到的 JS 文件是 <code>https://example.com/assets/home.js</code> ，所以一级路由可以正常访问到。</p><p>访问二级路由时， <code>./</code> 访问到的 JS 文件是 <code>https://example.com/foo/assets/bar.js</code> ，但实际上文件是存放在 <code>https://example.com/assets/bar.js</code> ，访问到的 URL 资源不存在，所以白屏了。</p><h5 id="解决方案-1" tabindex="-1"><a class="header-anchor" href="#解决方案-1" aria-hidden="true">#</a> 解决方案</h5><p>如果你的项目开启了 History 模式，并且配置有二级或者二级以上的路由时，不要使用 <code>./</code> 这样的相对路径。</p><p>正确的方式应该是修改 <a href="https://cli.vuejs.org/zh/config/#publicpath" target="_blank" rel="noopener noreferrer">publicPath<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （使用 Vue CLI ） 或者 <a href="https://cn.vitejs.dev/config/#base" target="_blank" rel="noopener noreferrer">base<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （使用 Vite ），如果是部署在域名根目录则写 <code>/</code> ，如果是子目录，则按照子目录的格式，将其以 <code>/</code> 开头，以 <code>/</code> 结尾的形式配置（ e.g. <code>/hello-world/</code> ）</p><h3 id="服务端配置" tabindex="-1"><a class="header-anchor" href="#服务端配置" aria-hidden="true">#</a> 服务端配置</h3><p>如果你使用的是 HTML5 的 History 模式，那么服务端也需要配置对应的支持，否则会出现路由跳转正常，但页面一刷新就 404 的情况。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>服务端配置后，就不再进入 404 了，你需要在项目里手动配置 <a href="#_404%E8%B7%AF%E7%94%B1%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE-new">404路由页面</a> 的路由。</p></div><h4 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx" aria-hidden="true">#</a> Nginx</h4><p>公司的服务端基本都是 Nginx 吧！可以把这段代码发给你们的运维工程师去参考配置：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="express" tabindex="-1"><a class="header-anchor" href="#express" aria-hidden="true">#</a> Express</h4><p>如果是前端自己用 Node.js 写服务端，并且用的是 Express 服务端框架，那么更简单：</p><ol><li>先安装中间件</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> connect-history-api-fallback
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>在服务启动入口文件里导入并激活</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;connect-history-api-fallback&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 创建 Express 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app
  <span class="token comment">// 启用 History 中间件</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 这里是读取打包后的页面文件目录</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;../dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>更多用法可以看： <a href="https://github.com/bripkens/connect-history-api-fallback" target="_blank" rel="noopener noreferrer">connect-history-api-fallback<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的文档。</p><h4 id="更多方案" tabindex="-1"><a class="header-anchor" href="#更多方案" aria-hidden="true">#</a> 更多方案</h4><p>其他的诸如 Apache 、 IIS 、或者原生 Node 等等配置方案， Vue 官方都提供了对应的演示代码，点击查看更多配置方案： <a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B" target="_blank" rel="noopener noreferrer">服务器配置示例<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 。</p><h2 id="本章结语" tabindex="-1"><a class="header-anchor" href="#本章结语" aria-hidden="true">#</a> 本章结语</h2><p>路由在我们的实际项目里，是非常重要的一个部分，Vue 3 相对 2.x 来说，新版路由带来的变化不算特别多，但是那些变化足以让人一开始摸不着头脑（比如以前直接通过 <code>this.$route</code> 来操作路由，现在必须通过 <code>useRoute</code> 等等），还是要慢慢习惯下。</p><!----><!----><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/chengpeiquan/learning-vue3/edit/main/docs/router.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: chengpeiquan@chengpeiquan.com">chengpeiquan</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/component.html" class="" aria-label="单组件的编写"><!--[--><!--]--> 单组件的编写 <!--[--><!--]--></a></span><span class="next"><a href="/plugin.html" class="" aria-label="插件的使用"><!--[--><!--]--> 插件的使用 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.0c7b3152.js" defer></script>
  </body>
</html>
