<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.41">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="https://chengpeiquan.com/favicon.ico"><meta name="keywords" content="vue 3, vue 3.x, vue 3 入门, vue 3 教程, 学习 vue 3, vue 3 案例, vue 3 教学, vue 3 好用吗"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png"><link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png"><meta name="msapplication-TileColor" content="#000000"><title>组件之间的通信 | Vue3 入门指南与实战案例</title><meta name="description" content="这是一个关于 Vue 3 + TypeScript 的起步学习教程，适合完全的Vue新手和Vue 2.0的老手，在官方文档的基础上融入自己的一些实践经验。">
    <link rel="modulepreload" href="/assets/app.0c7b3152.js"><link rel="modulepreload" href="/assets/communication.html.19f6b2f7.js"><link rel="modulepreload" href="/assets/communication.html.be61d0ec.js"><link rel="prefetch" href="/assets/index.html.2f003589.js"><link rel="prefetch" href="/assets/component.html.3d44d9c3.js"><link rel="prefetch" href="/assets/efficient.html.a26166bb.js"><link rel="prefetch" href="/assets/guide.html.adff52ae.js"><link rel="prefetch" href="/assets/links.html.b094a747.js"><link rel="prefetch" href="/assets/pinia.html.7109bbd7.js"><link rel="prefetch" href="/assets/plugin.html.e84e0166.js"><link rel="prefetch" href="/assets/router.html.86285e99.js"><link rel="prefetch" href="/assets/update.html.e870f97c.js"><link rel="prefetch" href="/assets/404.html.9b42cd8b.js"><link rel="prefetch" href="/assets/index.html.5f058d06.js"><link rel="prefetch" href="/assets/component.html.f5307f9d.js"><link rel="prefetch" href="/assets/efficient.html.ad1f20a6.js"><link rel="prefetch" href="/assets/guide.html.90f201ac.js"><link rel="prefetch" href="/assets/links.html.62996d14.js"><link rel="prefetch" href="/assets/pinia.html.642f88d2.js"><link rel="prefetch" href="/assets/plugin.html.eb66815b.js"><link rel="prefetch" href="/assets/router.html.60990ba2.js"><link rel="prefetch" href="/assets/update.html.100e2c95.js"><link rel="prefetch" href="/assets/404.html.4675e898.js"><link rel="prefetch" href="/assets/404.d3026537.js"><link rel="prefetch" href="/assets/Layout.527176c4.js"><link rel="prefetch" href="/assets/GitalkComment.3ff1abe3.js"><link rel="prefetch" href="/assets/GoogleAdsense.40b4bcba.js"><link rel="prefetch" href="/assets/ImgWrap.abf53801.js">
    <link rel="stylesheet" href="/assets/style.515263ec.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="https://vue3.chengpeiquan.com/assets/img/vue3.png" alt="Vue3 入门指南与实战案例"><span class="site-name can-hide">Vue3 入门指南与实战案例</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://chengpeiquan.com/" rel="noopener noreferrer" target="_blank" aria-label="博客首页"><!--[--><!--]--> 博客首页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/cooking-cookbook" rel="noopener noreferrer" target="_blank" aria-label="菜谱教程"><!--[--><!--]--> 菜谱教程 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/learning-vue3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://chengpeiquan.com/" rel="noopener noreferrer" target="_blank" aria-label="博客首页"><!--[--><!--]--> 博客首页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/cooking-cookbook" rel="noopener noreferrer" target="_blank" aria-label="菜谱教程"><!--[--><!--]--> 菜谱教程 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/chengpeiquan/learning-vue3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----></li><li><a href="/guide.html" class="sidebar-item sidebar-heading" aria-label="起步准备"><!--[--><!--]--> 起步准备 <!--[--><!--]--></a><!----></li><li><a href="/update.html" class="sidebar-item sidebar-heading" aria-label="升级与配置"><!--[--><!--]--> 升级与配置 <!--[--><!--]--></a><!----></li><li><a href="/component.html" class="sidebar-item sidebar-heading" aria-label="单组件的编写"><!--[--><!--]--> 单组件的编写 <!--[--><!--]--></a><!----></li><li><a href="/router.html" class="sidebar-item sidebar-heading" aria-label="路由的使用"><!--[--><!--]--> 路由的使用 <!--[--><!--]--></a><!----></li><li><a href="/plugin.html" class="sidebar-item sidebar-heading" aria-label="插件的使用"><!--[--><!--]--> 插件的使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="组件之间的通信"><!--[--><!--]--> 组件之间的通信 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#父子组件通信" class="router-link-active router-link-exact-active sidebar-item" aria-label="父子组件通信"><!--[--><!--]--> 父子组件通信 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#props-emits" class="router-link-active router-link-exact-active sidebar-item" aria-label="props / emits"><!--[--><!--]--> props / emits <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#下发-props" class="router-link-active router-link-exact-active sidebar-item" aria-label="下发 props"><!--[--><!--]--> 下发 props <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#接收-props" class="router-link-active router-link-exact-active sidebar-item" aria-label="接收 props"><!--[--><!--]--> 接收 props <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#带有类型限制的-props" class="router-link-active router-link-exact-active sidebar-item" aria-label="带有类型限制的 props"><!--[--><!--]--> 带有类型限制的 props <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#可选以及带有默认值的-props" class="router-link-active router-link-exact-active sidebar-item" aria-label="可选以及带有默认值的 props"><!--[--><!--]--> 可选以及带有默认值的 props <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#使用-props-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 props{new}"><!--[--><!--]--> 使用 props{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#传递非-prop-的-attribute" class="router-link-active router-link-exact-active sidebar-item" aria-label="传递非 Prop 的 Attribute"><!--[--><!--]--> 传递非 Prop 的 Attribute <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#获取非-prop-的-attribute-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取非 Prop 的 Attribute{new}"><!--[--><!--]--> 获取非 Prop 的 Attribute{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#绑定-emits-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="绑定 emits{new}"><!--[--><!--]--> 绑定 emits{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#接收-emits" class="router-link-active router-link-exact-active sidebar-item" aria-label="接收 emits"><!--[--><!--]--> 接收 emits <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#接收-emits-时做一些校验" class="router-link-active router-link-exact-active sidebar-item" aria-label="接收 emits 时做一些校验"><!--[--><!--]--> 接收 emits 时做一些校验 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#调用-emits-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="调用 emits{new}"><!--[--><!--]--> 调用 emits{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/communication.html#v-model-emits" class="router-link-active router-link-exact-active sidebar-item" aria-label="v-model / emits"><!--[--><!--]--> v-model / emits <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#绑定-v-model-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="绑定 v-model{new}"><!--[--><!--]--> 绑定 v-model{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#配置-emits" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置 emits"><!--[--><!--]--> 配置 emits <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#调用自身的-emits-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="调用自身的 emits{new}"><!--[--><!--]--> 调用自身的 emits{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/communication.html#ref-emits" class="router-link-active router-link-exact-active sidebar-item" aria-label="ref / emits"><!--[--><!--]--> ref / emits <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#父组件操作子组件-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="父组件操作子组件{new}"><!--[--><!--]--> 父组件操作子组件{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#子组件通知父组件" class="router-link-active router-link-exact-active sidebar-item" aria-label="子组件通知父组件"><!--[--><!--]--> 子组件通知父组件 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/communication.html#爷孙组件通信" class="router-link-active router-link-exact-active sidebar-item" aria-label="爷孙组件通信"><!--[--><!--]--> 爷孙组件通信 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#provide-inject" class="router-link-active router-link-exact-active sidebar-item" aria-label="provide / inject"><!--[--><!--]--> provide / inject <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#发起-provide-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="发起 provide{new}"><!--[--><!--]--> 发起 provide{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#接收-inject-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="接收 inject{new}"><!--[--><!--]--> 接收 inject{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#响应性数据的传递与接收-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="响应性数据的传递与接收{new}"><!--[--><!--]--> 响应性数据的传递与接收{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#引用类型的传递与接收" class="router-link-active router-link-exact-active sidebar-item" aria-label="引用类型的传递与接收"><!--[--><!--]--> 引用类型的传递与接收 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#基本类型的传递与接收" class="router-link-active router-link-exact-active sidebar-item" aria-label="基本类型的传递与接收"><!--[--><!--]--> 基本类型的传递与接收 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/communication.html#兄弟组件通信" class="router-link-active router-link-exact-active sidebar-item" aria-label="兄弟组件通信"><!--[--><!--]--> 兄弟组件通信 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#全局组件通信" class="router-link-active router-link-exact-active sidebar-item" aria-label="全局组件通信"><!--[--><!--]--> 全局组件通信 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#eventbus-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="EventBus{new}"><!--[--><!--]--> EventBus{new} <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#回顾-vue-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="回顾 Vue 2"><!--[--><!--]--> 回顾 Vue 2 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#了解-vue-3-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="了解 Vue 3{new}"><!--[--><!--]--> 了解 Vue 3{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#创建-3-x-的-eventbus-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建 3.x 的 EventBus{new}"><!--[--><!--]--> 创建 3.x 的 EventBus{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#创建和移除监听事件-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建和移除监听事件{new}"><!--[--><!--]--> 创建和移除监听事件{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#调用监听事件-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="调用监听事件{new}"><!--[--><!--]--> 调用监听事件{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#旧项目升级-eventbus" class="router-link-active router-link-exact-active sidebar-item" aria-label="旧项目升级 EventBus"><!--[--><!--]--> 旧项目升级 EventBus <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/communication.html#vuex-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="Vuex{new}"><!--[--><!--]--> Vuex{new} <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/communication.html#在了解之前" class="router-link-active router-link-exact-active sidebar-item" aria-label="在了解之前"><!--[--><!--]--> 在了解之前 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#vuex-的目录结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="Vuex 的目录结构"><!--[--><!--]--> Vuex 的目录结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#回顾-vue-2-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="回顾 Vue 2"><!--[--><!--]--> 回顾 Vue 2 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#了解-vue-3-new-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="了解 Vue 3{new}"><!--[--><!--]--> 了解 Vue 3{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#vuex-的配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="Vuex 的配置"><!--[--><!--]--> Vuex 的配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#在组件里使用-vuex-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="在组件里使用 Vuex{new}"><!--[--><!--]--> 在组件里使用 Vuex{new} <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/communication.html#pinia-new" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pinia{new}"><!--[--><!--]--> Pinia{new} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/communication.html#本章结语" class="router-link-active router-link-exact-active sidebar-item" aria-label="本章结语"><!--[--><!--]--> 本章结语 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/pinia.html" class="sidebar-item sidebar-heading" aria-label="全局状态的管理"><!--[--><!--]--> 全局状态的管理 <!--[--><!--]--></a><!----></li><li><a href="/efficient.html" class="sidebar-item sidebar-heading" aria-label="高效开发"><!--[--><!--]--> 高效开发 <!--[--><!--]--></a><!----></li><li><a href="/links.html" class="sidebar-item sidebar-heading" aria-label="拓展阅读"><!--[--><!--]--> 拓展阅读 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="组件之间的通信" tabindex="-1"><a class="header-anchor" href="#组件之间的通信" aria-hidden="true">#</a> 组件之间的通信</h1><p>经过前面的那几部分的阅读，相信搭一个基础的 Vue 3.0 项目应该没什么问题了！</p><p>但实际业务开发过程中，还会遇到一些组件之间的通信问题，父子组件通信、兄弟组件通信、爷孙组件通信，还有一些全局通信的场景。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>这一章节的内容，3.x 对比 2.x 变化都比较大！</p></div><p>这一章就按使用场景来划分对应的章节吧，在什么场景下遇到问题，也方便快速找到对应的处理办法。</p><table><thead><tr><th style="text-align:left;">通信场景</th><th style="text-align:left;">快速定位</th></tr></thead><tbody><tr><td style="text-align:left;">父子组件通信</td><td style="text-align:left;"><a href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">点击查看</a></td></tr><tr><td style="text-align:left;">爷孙组件通信</td><td style="text-align:left;"><a href="#%E7%88%B7%E5%AD%99%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">点击查看</a></td></tr><tr><td style="text-align:left;">兄弟组件通信</td><td style="text-align:left;"><a href="#%E5%85%84%E5%BC%9F%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">点击查看</a></td></tr><tr><td style="text-align:left;">全局组件通信</td><td style="text-align:left;"><a href="#%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">点击查看</a></td></tr></tbody></table><h2 id="父子组件通信" tabindex="-1"><a class="header-anchor" href="#父子组件通信" aria-hidden="true">#</a> 父子组件通信</h2><p>父子组件通信是指，B 组件引入到 A 组件里渲染，此时 A 是 B 的父级；B 组件的一些数据需要从A组件拿，B 组件有时也要告知 A 组件一些数据变化情况。</p><p>他们之间的关系如下，<code>Child.vue</code> 是直接挂载在 <code>Father.vue</code> 下面：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Father.vue
└─Child.vue
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>常用的方法有：</p><table><thead><tr><th style="text-align:left;">方案</th><th style="text-align:left;">父组件向子组件</th><th style="text-align:left;">子组件向父组件</th><th style="text-align:left;">对应章节传送门</th></tr></thead><tbody><tr><td style="text-align:left;">props / emits</td><td style="text-align:left;">props</td><td style="text-align:left;">emits</td><td style="text-align:left;"><a href="#props-emits">点击查看</a></td></tr><tr><td style="text-align:left;">v-model / emits</td><td style="text-align:left;">v-model</td><td style="text-align:left;">emits</td><td style="text-align:left;"><a href="#v-model-emits">点击查看</a></td></tr><tr><td style="text-align:left;">ref / emits</td><td style="text-align:left;">ref</td><td style="text-align:left;">emits</td><td style="text-align:left;"><a href="#ref-emits">点击查看</a></td></tr><tr><td style="text-align:left;">provide / inject</td><td style="text-align:left;">provide</td><td style="text-align:left;">inject</td><td style="text-align:left;"><a href="#provide-inject">点击查看</a></td></tr><tr><td style="text-align:left;">EventBus</td><td style="text-align:left;">emit / on</td><td style="text-align:left;">emit / on</td><td style="text-align:left;"><a href="#eventbus-new">点击查看</a></td></tr><tr><td style="text-align:left;">Vuex</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td><td style="text-align:left;"><a href="#vuex-new">点击查看</a></td></tr></tbody></table><p>为了方便阅读，下面的父组件统一叫 <code>Father.vue</code>，子组件统一叫 <code>Child.vue</code>。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>在 2.x，有的同学可能喜欢用 <code>$attrs / $listeners</code> 来进行通信，但该方案在 3.x 已经移除了，详见 <a href="https://v3.cn.vuejs.org/guide/migration/listeners-removed.html" target="_blank" rel="noopener noreferrer">移除 $listeners<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><h2 id="props-emits" tabindex="-1"><a class="header-anchor" href="#props-emits" aria-hidden="true">#</a> props / emits</h2><p>这是Vue跨组件通信最常用，也是基础的一个方案，它的通信过程是：</p><ol><li><p><code>Father.vue</code> 通过 <code>prop</code> 向 <code>Child.vue</code> 传值（可包含父级定义好的函数）</p></li><li><p><code>Child.vue</code> 通过 <code>emit</code> 向 <code>Father.vue</code> 触发父组件的事件执行</p></li></ol><h3 id="下发-props" tabindex="-1"><a class="header-anchor" href="#下发-props" aria-hidden="true">#</a> 下发 props</h3><p>下发的过程是在 <code>Father.vue</code> 里完成的，父组件在向子组件下发 <code>props</code> 之前，需要导入子组件并启用它作为自身的模板，然后在 <code>setup</code> 里处理好数据，return 给 <code>template</code> 用。</p><p>在 <code>Father.vue</code> 的 <code>script</code> 里：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;@cp/Child.vue&#39;</span>

<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 需要启用子组件作为模板</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Child
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 定义一些数据并return给template用</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&#39;Petter&#39;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 不要忘记return，否则template拿不到数据</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      userInfo
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>然后在 <code>Father.vue</code> 的 <code>template</code> 这边拿到 return 出来的数据，把要传递的数据通过属性的方式绑定在 <code>template</code> 的组件标签上。</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span>
    <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户信息<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:uid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.id<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:user-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.name<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样就完成了 <code>props</code> 数据的下发。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><ol><li><p>在 <code>template</code> 绑定属性这里，如果是普通的字符串，比如上面的 <code>title</code>，则直接给属性名赋值就可以</p></li><li><p>如果是变量，或者其他类型如 <code>Number</code>、<code>Object</code> 等，则需要通过属性动态绑定的方式来添加，使用 <code>v-bind:</code> 或者 <code>:</code> 符号进行绑定</p></li><li><p>官方建议 prop 在 <code>template</code> 统一采用短横线分隔命名 （详见：<a href="https://v3.cn.vuejs.org/guide/component-props.html#prop-%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99%E5%91%BD%E5%90%8D-camelcase-vs-kebab-case" target="_blank" rel="noopener noreferrer">Prop 的大小写命名<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>），但实际上你采用驼峰也是可以正确拿到值，因为 Vue 的源码里有做转换</p></li></ol></div><h3 id="接收-props" tabindex="-1"><a class="header-anchor" href="#接收-props" aria-hidden="true">#</a> 接收 props</h3><p>接收的过程是在 <code>Child.vue</code> 里完成的，在 <code>script</code> 部分，子组件通过与 <code>setup</code> 同级的 <code>props</code> 来接收数据。</p><p>它可以是一个数组，每个 <code>item</code> 都是 <code>String</code> 类型，把你要接受的变量名放到这个数组里，直接放进来作为数组的 <code>item</code>：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;userName&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;uid&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>但这种情况下，使用者不知道这些属性到底是什么类型的值，是否必传。</p><h3 id="带有类型限制的-props" tabindex="-1"><a class="header-anchor" href="#带有类型限制的-props" aria-hidden="true">#</a> 带有类型限制的 props</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>既然我们最开始在决定使用 Vue 3.0 的时候，为了更好的类型限制，已经决定写 TypeScript ，那么我们最好不要出现这种使用情况。</p><p><strong>推荐的方式是把 <code>props</code> 定义为一个对象，以对象形式列出 <code>prop</code>，每个 <code>property</code> 的名称和值分别是 <code>prop</code> 各自的名称和类型，只有合法的类型才允许传入。</strong></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>注意，和 TS 的类型定义不同， <code>props</code> 这里的类型，首字母需要大写。</p></div><p>支持的类型有：</p><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">String</td><td style="text-align:left;">字符串</td></tr><tr><td style="text-align:left;">Number</td><td style="text-align:left;">数值</td></tr><tr><td style="text-align:left;">Boolean</td><td style="text-align:left;">布尔值</td></tr><tr><td style="text-align:left;">Array</td><td style="text-align:left;">数组</td></tr><tr><td style="text-align:left;">Object</td><td style="text-align:left;">对象</td></tr><tr><td style="text-align:left;">Date</td><td style="text-align:left;">日期数据，e.g. new Date()</td></tr><tr><td style="text-align:left;">Function</td><td style="text-align:left;">函数，e.g. 普通函数、箭头函数、构造函数</td></tr><tr><td style="text-align:left;">Promise</td><td style="text-align:left;">Promise 类型的函数</td></tr><tr><td style="text-align:left;">Symbol</td><td style="text-align:left;">Symbol 类型的值</td></tr></tbody></table><p>于是我们把 <code>props</code> 再改一下，加上类型限制：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> String<span class="token punctuation">,</span>
    index<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    userName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    uid<span class="token operator">:</span> Number
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样我们如果传入不正确的类型，程序就会抛出警告信息，告知开发者必须正确传值。</p><p>如果你需要对某个 <code>prop</code> 允许多类型，比如这个 <code>uid</code> 字段，它可能是数值，也可能是字符串，那么可以在类型这里，使用一个数组，把允许的类型都加进去。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 单类型</span>
    title<span class="token operator">:</span> String<span class="token punctuation">,</span>
    index<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    userName<span class="token operator">:</span> String<span class="token punctuation">,</span>

    <span class="token comment">// 这里使用了多种类型</span>
    uid<span class="token operator">:</span> <span class="token punctuation">[</span> Number<span class="token punctuation">,</span> String <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="可选以及带有默认值的-props" tabindex="-1"><a class="header-anchor" href="#可选以及带有默认值的-props" aria-hidden="true">#</a> 可选以及带有默认值的 props</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>有时候我们想对一些 <code>prop</code> 设置为可选，然后提供一些默认值，还可以再将 <code>prop</code> 再进一步设置为对象，支持的字段有：</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">类型</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">type</td><td style="text-align:left;">string</td><td style="text-align:left;">prop 的类型</td></tr><tr><td style="text-align:left;">required</td><td style="text-align:left;">boolean</td><td style="text-align:left;">是否必传，true=必传，false=可选</td></tr><tr><td style="text-align:left;">default</td><td style="text-align:left;">any</td><td style="text-align:left;">与 type 字段的类型相对应的默认值，如果 required 是 false ，但这里不设置默认值，则会默认为 <code>undefined</code></td></tr><tr><td style="text-align:left;">validator</td><td style="text-align:left;">function</td><td style="text-align:left;">自定义验证函数，需要 return 一个布尔值，true=校验通过，false=校验不通过，当校验不通过时，控制台会抛出警告信息</td></tr></tbody></table><p>我们现在再对 <code>props</code> 改造一下，对部分字段设置为可选，并提供默认值：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可选，并提供默认值</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;默认标题&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 默认可选，单类型</span>
    index<span class="token operator">:</span> Number<span class="token punctuation">,</span>

    <span class="token comment">// 添加一些自定义校验</span>
    userName<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>

      <span class="token comment">// 在这里校验用户名必须至少3个字</span>
      <span class="token function-variable function">validator</span><span class="token operator">:</span> v <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 默认可选，但允许多种类型</span>
    uid<span class="token operator">:</span> <span class="token punctuation">[</span> Number<span class="token punctuation">,</span> String <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="使用-props-new" tabindex="-1"><a class="header-anchor" href="#使用-props-new" aria-hidden="true">#</a> 使用 props{new}</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>在 <code>template</code> 部分，3.x 的使用方法和 2.x 是一样的，比如要渲染我们上面传入的 <code>props</code> ：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>标题：{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>索引：{{ index }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>用户id：{{ uid }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>用户名：{{ userName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>但是 <code>script</code> 部分，变化非常大！</strong></p><p>在 2.x ，只需要通过 <code>this.uid</code>、<code>this.userName</code> 就可以使用父组件传下来的 <code>prop</code> 。</p><p>但是 3.x 没有了 <code>this</code>， 需要给 <code>setup</code> 添加一个入参才可以去操作。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> String<span class="token punctuation">,</span>
    index<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    userName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    uid<span class="token operator">:</span> Number
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 在这里需要添加一个入参</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 该入参包含了我们定义的所有props</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><ol><li><p><code>prop</code> 是只读，不允许修改</p></li><li><p><code>setup</code> 的第一个入参，包含了我们定义的所有props（如果在 <code>Child.vue</code> 里未定义，但 父组件 <code>Father.vue</code> 那边非要传过来的，不会拿到，且控制台会有警告信息）</p></li><li><p>该入参可以随意命名，比如你可以写成一个下划线 <code>_</code>，通过 <code>_.uid</code> 也可以拿到数据，但是语义化命名，是一个良好的编程习惯。</p></li></ol></div><h3 id="传递非-prop-的-attribute" tabindex="-1"><a class="header-anchor" href="#传递非-prop-的-attribute" aria-hidden="true">#</a> 传递非 Prop 的 Attribute</h3><p>上面的提示里有提到一句：</p><blockquote><p>如果在 <code>Child.vue</code> 里未定义，但 父组件 <code>Father.vue</code> 那边非要传过来的，不会拿到，且控制台会有警告信息</p></blockquote><p>但并不意味着你不能传递任何未定义的属性数据，在父组件，除了可以给子组件绑定 props，你还可以根据实际需要去绑定一些特殊的属性。</p><p>比如给子组件设置 <code>class</code>、<code>id</code>，或者 <code>data-xxx</code> 之类的一些自定义属性，<strong>如果 <code>Child.vue</code> 组件的 <code>template</code> 只有一个根节点，这些属性默认自动继承，并渲染在 node 节点上</strong>。</p><p>在 <code>Father.vue</code> 里，对 <code>Child.vue</code> 传递了 <code>class</code>、<code>id</code> 和 <code>data-hash</code>：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">keys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aaaa<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">data-hash</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afJasdHGUHa87d688723kjaghdhja<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>渲染后（2个 <code>data-v-xxx</code> 是父子组件各自的 <code>css scoped</code> 标记）：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">keys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aaaa<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">data-hash</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afJasdHGUHa87d688723kjaghdhja<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">data-v-2dcc19c8</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">data-v-7eb2bc79</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Child的内容 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>你可以在 <code>Child.vue</code> 配置 <code>inheritAttrs</code> 为 <code>false</code>，来屏蔽这些自定义属性的渲染。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  inheritAttrs<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...    </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="获取非-prop-的-attribute-new" tabindex="-1"><a class="header-anchor" href="#获取非-prop-的-attribute-new" aria-hidden="true">#</a> 获取非 Prop 的 Attribute{new}</h3><p>想要拿到这些属性，原生操作需要通过 <code>element.getAttribute</code> ，但 Vue 也提供了相关的 API ：</p><p>在 <code>Child.vue</code> 里，可以通过 <code>setup</code> 的第二个参数 <code>context</code> 里的 <code>attrs</code> 来获取到这些属性。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// attrs 是个对象，每个 Attribute 都是它的 key</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果传下来的 Attribute 带有短横线，需要通过这种方式获取</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">[</span><span class="token string">&#39;data-hash&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><ol><li><p><code>attr</code> 和 <code>prop</code> 一样，都是只读的</p></li><li><p>不管 <code>inheritAttrs</code> 是否设置，都可以通过 <code>attrs</code> 拿到这些数据，但是 <code>element.getAttribute</code> 则只有 <code>inheritAttrs</code> 为 <code>true</code> 的时候才可以。</p></li></ol></div><p>Vue 3 的 <code>template</code> 还允许多个根节点，多个根节点的情况下，无法直接继承这些属性，需要在 <code>Child.vue</code> 指定继承在哪个节点上，否则会有警告信息。</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 指定继承 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 指定继承 --&gt;</span>
  
  <span class="token comment">&lt;!-- 这些不会自动继承 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 这些不会自动继承 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当然，前提依然是，<code>setup</code> 里要把 <code>attrs</code> 给 <code>return</code> 出来。</p><p>查看详情：<a href="https://v3.cn.vuejs.org/guide/component-attrs.html#%E5%A4%9A%E4%B8%AA%E6%A0%B9%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84-attribute-%E7%BB%A7%E6%89%BF" target="_blank" rel="noopener noreferrer">多个根节点上的 Attribute 继承<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="绑定-emits-new" tabindex="-1"><a class="header-anchor" href="#绑定-emits-new" aria-hidden="true">#</a> 绑定 emits{new}</h3><p>最开始有介绍到，子组件如果需要向父组件告知数据更新，或者执行某些函数时，是通过 emits 来进行的。</p><p>每个 <code>emit</code> 都是事件，所以需要先由父组件先给子组件绑定，子组件才能知道应该怎么去调用。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>当然，父组件也是需要先在 <code>setup</code> 里进行定义并 <code>return</code>，才能够在 <code>template</code> 里绑定给子组件。</p></div><p>比如要给 <code>Child.vue</code> 绑定一个更新用户年龄的方法，那么在 <code>Father.vue</code> 里需要这么处理：</p><p>先看 <code>script</code> 部分（留意注释部分）：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;@cp/Child.vue&#39;</span>

<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Child
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&#39;Petter&#39;</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义一个更新年龄的方法</span>
    <span class="token keyword">const</span> updateAge <span class="token operator">=</span> <span class="token punctuation">(</span>age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      userInfo<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      userInfo<span class="token punctuation">,</span>

      <span class="token comment">// return给template用</span>
      updateAge
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>再看 <code>template</code> 部分（为了方便阅读，我把之前绑定的 props 先去掉了）：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span>
    <span class="token attr-name">@update-age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateAge<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><ol><li><p>动态绑定 <code>props</code> 是用 <code>:</code>，绑定 <code>emit</code> 是用 <code>@</code></p></li><li><p>关于绑定的这个 <code>@</code> 符号，其实很好记忆，因为在 Vue 的 <code>template</code> 里，所有的事件绑定都是通过 <code>@</code>，比如 <code>@click</code>、<code>@change</code> 等等</p></li><li><p>同样的，在绑定 <code>emit</code> 时，也需要使用短横线写法（详见：<a href="https://v3.cn.vuejs.org/guide/component-custom-events.html#%E4%BA%8B%E4%BB%B6%E5%90%8D" target="_blank" rel="noopener noreferrer">事件名<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）</p></li></ol></div><h3 id="接收-emits" tabindex="-1"><a class="header-anchor" href="#接收-emits" aria-hidden="true">#</a> 接收 emits</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>和 <code>props</code> 一样，你可以指定是一个数组，把要接收的 <code>emit</code> 名称写进去：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;update-age&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其实日常这样配置就足够用了。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><ol><li><p>这里的 <code>emit</code> 名称指 <code>Father.vue</code> 在给 <code>Child.vue</code> 绑定事件时，<code>template</code> 里面给子组件指定的 <code>@aaaaa=&quot;bbbbb&quot;</code> 里的 <code>aaaaa</code></p></li><li><p>当在 emits 选项中定义了原生事件 (如 <code>click</code> ) 时，将使用组件中的事件替代原生事件侦听器</p></li></ol></div><h3 id="接收-emits-时做一些校验" tabindex="-1"><a class="header-anchor" href="#接收-emits-时做一些校验" aria-hidden="true">#</a> 接收 emits 时做一些校验</h3><p>当然你也可以对这些事件做一些验证，配置为对象，然后把这个 <code>emit</code> 名称作为 <code>key</code>， <code>value</code> 则配置为一个方法。</p><p>比如上面的更新年龄，只允许达到成年人的年龄才会去更新父组件的数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  emits<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要校验</span>
    <span class="token string-property property">&#39;update-age&#39;</span><span class="token operator">:</span> <span class="token punctuation">(</span>age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 写一些条件拦截，记得返回false</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> age <span class="token operator">&lt;</span> <span class="token number">18</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;未成年人不允许参与&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 通过则返回true</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 一些无需校验的，设置为null即可</span>
    <span class="token string-property property">&#39;update-name&#39;</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="调用-emits-new" tabindex="-1"><a class="header-anchor" href="#调用-emits-new" aria-hidden="true">#</a> 调用 emits{new}</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>和 <code>props</code> 一样，也需要在 <code>setup</code> 的入参里引入 <code>emit</code> ，才允许操作。</p><p><code>setup</code> 的第二个入参 <code>expose</code> 是一个对象，你可以完整导入 <code>expose</code> 然后通过 <code>expose.emit</code> 去操作，也可以按需导入 <code>{ emit }</code> （推荐这种方式）：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;update-age&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// 2s 后更新年龄</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;update-age&#39;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>emit</code> 的第二个参数开始是父组件那边要接收的自定义数据，为了开发上的便利，建议如果需要传多个数据的情况下，直接将第二个参数设置为一个对象，把所有数据都放到对象里，传递和接收起来都会方便很多。</p></div><h2 id="v-model-emits" tabindex="-1"><a class="header-anchor" href="#v-model-emits" aria-hidden="true">#</a> v-model / emits</h2><p>对比 <code>props / emits</code> ，这个方式更为简单：</p><ol><li><p>在 <code>Father.vue</code> ，通过 <code>v-model</code> 向 <code>Child.vue</code> 传值</p></li><li><p><code>Child.vue</code> 通过自身设定的 emits 向 <code>Father.vue</code> 通知数据更新</p></li></ol><p><code>v-model</code> 的用法和 <code>props</code> 非常相似，但是很多操作上更为简化，但操作简单带来的 “副作用” ，就是功能上也没有 <code>props</code> 那么多。</p><h3 id="绑定-v-model-new" tabindex="-1"><a class="header-anchor" href="#绑定-v-model-new" aria-hidden="true">#</a> 绑定 v-model{new}</h3><p>它的和下发 props 的方式类似，都是在子组件上绑定 <code>Father.vue</code> 定义好并 <code>return</code> 出来的数据。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><ol><li><p>和 2.x 不同， 3.x 可以直接绑定 <code>v-model</code> ，而无需在子组件指定 <code>model</code> 选项。</p></li><li><p>另外，3.x 的 <code>v-model</code> 需要使用 <code>:</code> 来指定你要绑定的属性名，同时也开始支持绑定多个 <code>v-model</code></p></li></ol></div><p>我们来看看具体的操作：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span>
    <span class="token attr-name"><span class="token namespace">v-model:</span>user-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.name<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果你要绑定多个数据，写多个 <code>v-model</code> 即可</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span>
    <span class="token attr-name"><span class="token namespace">v-model:</span>user-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.name<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">v-model:</span>uid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userInfo.id<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>看到这里应该能明白了，一个 <code>v-model</code> 其实就是一个 <code>prop</code>，它支持的数据类型，和 <code>prop</code> 是一样的。</p><p>所以，子组件在接收数据的时候，完全按照 <code>props</code> 去定义就可以了。</p><p>点击回顾：<a href="#%E6%8E%A5%E6%94%B6-props">接收 props</a> ，了解在 <code>Child.vue</code> 如何接收 <code>props</code>，以及相关的 <code>props</code> 类型限制等部分内容。</p><h3 id="配置-emits" tabindex="-1"><a class="header-anchor" href="#配置-emits" aria-hidden="true">#</a> 配置 emits</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>虽然 <code>v-model</code> 的配置和 <code>prop</code> 相似，但是为什么出这么两个相似的东西？自然是为了简化一些开发上的操作。</p><p>使用 props / emits，如果要更新父组件的数据，还需要在父组件定义好方法，然后 <code>return</code> 给 <code>template</code> 去绑定事件给子组件，才能够更新。</p><p>而使用 <code>v-model / emits</code> ，无需如此，可以在 <code>Child.vue</code> 直接通过 “update:属性名” 的格式，直接定义一个更新事件：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    userName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    uid<span class="token operator">:</span> Number
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;update:userName&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;update:uid&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这里的 update 后面的属性名，支持驼峰写法，这一部分和 2.x 的使用是相同的。</p><p>这里也可以对数据更新做一些校验，配置方式和 <a href="#%E6%8E%A5%E6%94%B6-emits-%E6%97%B6%E5%81%9A%E4%B8%80%E4%BA%9B%E6%A0%A1%E9%AA%8C">接收 emits 时做一些校验</a> 是一样的。</p><h3 id="调用自身的-emits-new" tabindex="-1"><a class="header-anchor" href="#调用自身的-emits-new" aria-hidden="true">#</a> 调用自身的 emits{new}</h3><blockquote><p>注：这一小节的步骤是在 <code>Child.vue</code> 里操作。</p></blockquote><p>在 <code>Child.vue</code> 配置好 emits 之后，就可以在 <code>setup</code> 里直接操作数据的更新了：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 2s 后更新用户名</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;update:userName&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Tom&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在使用上，和 <a href="#%E8%B0%83%E7%94%A8-emits-new">调用 emits</a> 是一样的。</p><h2 id="ref-emits" tabindex="-1"><a class="header-anchor" href="#ref-emits" aria-hidden="true">#</a> ref / emits</h2><p>在学习 <a href="/component.html#%E5%93%8D%E5%BA%94%E5%BC%8F-api-%E4%B9%8B-ref-new" class="">响应式 API 之 ref</a> 的时候，我们了解到 <code>ref</code> 是可以用在 <a href="/component.html#dom-%E5%85%83%E7%B4%A0%E4%B8%8E%E5%AD%90%E7%BB%84%E4%BB%B6" class="">DOM 元素与子组件</a> 上面。</p><h3 id="父组件操作子组件-new" tabindex="-1"><a class="header-anchor" href="#父组件操作子组件-new" aria-hidden="true">#</a> 父组件操作子组件{new}</h3><p>所以，父组件也可以直接通过对子组件绑定 <code>ref</code> 属性，然后通过 ref 变量去操作子组件的数据或者调用里面的方法。</p><p>比如导入了一个 <code>Child.vue</code> 作为子组件，需要在 <code>template</code> 处给子组件标签绑定 <code>ref</code>：</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后在 <code>script</code> 部分定义好对应的变量名称（记得要 <code>return</code> 出来）：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;@cp/Child.vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Child
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 给子组件定义一个ref变量</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 请保证视图渲染完毕后再执行操作</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行子组件里面的ajax函数</span>
      child<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 打开子组件里面的弹窗</span>
      child<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 必须return出去才可以给到template使用</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      child
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="子组件通知父组件" tabindex="-1"><a class="header-anchor" href="#子组件通知父组件" aria-hidden="true">#</a> 子组件通知父组件</h3><p>子组件如果想主动向父组件通讯，也需要使用 <code>emit</code>，详细的配置方法可见：<a href="#%E7%BB%91%E5%AE%9A-emits-new">绑定 emits</a></p><h2 id="爷孙组件通信" tabindex="-1"><a class="header-anchor" href="#爷孙组件通信" aria-hidden="true">#</a> 爷孙组件通信</h2><p>顾名思义，爷孙组件是比 <a href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">父子组件通信</a> 要更深层次的引用关系（也有称之为 “隔代组件”）：</p><p>C组件引入到B组件里，B组件引入到A组件里渲染，此时A是C的爷爷级别（可能还有更多层级关系），如果你用 <code>props</code> ，只能一级一级传递下去，那就太繁琐了，因此我们需要更直接的通信方式。</p><p>他们之间的关系如下，<code>Grandson.vue</code> 并非直接挂载在 <code>Grandfather.vue</code> 下面，他们之间还隔着至少一个 <code>Son.vue</code> （可能有多个）：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Grandfather.vue
└─Son.vue
  └─Grandson.vue
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这一 Part 就是讲一讲 C 和 A 之间的数据传递，常用的方法有：</p><table><thead><tr><th style="text-align:left;">方案</th><th style="text-align:left;">爷组件向孙组件</th><th style="text-align:left;">孙组件向爷组件</th><th style="text-align:left;">对应章节传送门</th></tr></thead><tbody><tr><td style="text-align:left;">provide / inject</td><td style="text-align:left;">provide</td><td style="text-align:left;">inject</td><td style="text-align:left;"><a href="#provide-inject">点击查看</a></td></tr><tr><td style="text-align:left;">EventBus</td><td style="text-align:left;">emit / on</td><td style="text-align:left;">emit / on</td><td style="text-align:left;"><a href="#eventbus-new">点击查看</a></td></tr><tr><td style="text-align:left;">Vuex</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td><td style="text-align:left;"><a href="#vuex-new">点击查看</a></td></tr></tbody></table><p>为了方便阅读，下面的父组件统一叫 <code>Grandfather.vue</code>，子组件统一叫 <code>Grandson.vue</code>，但实际上他们之间可以隔无数代…</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>因为上下级的关系的一致性，爷孙组件通信的方案也适用于 <a href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">父子组件通信</a> ，只需要把爷孙关系换成父子关系即可。</p></div><h2 id="provide-inject" tabindex="-1"><a class="header-anchor" href="#provide-inject" aria-hidden="true">#</a> provide / inject</h2><p>这个特性有两个部分：<code>Grandfather.vue</code> 有一个 <code>provide</code> 选项来提供数据，<code>Grandson.vue</code> 有一个 <code>inject</code> 选项来开始使用这些数据。</p><ol><li><p><code>Grandfather.vue</code> 通过 <code>provide</code> 向 <code>Grandson.vue</code> 传值（可包含定义好的函数）</p></li><li><p><code>Grandson.vue</code> 通过 <code>inject</code> 向 <code>Grandfather.vue</code> 触发爷爷组件的事件执行</p></li></ol><p>无论组件层次结构有多深，发起 <code>provide</code> 的组件都可以作为其所有下级组件的依赖提供者。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>这一部分的内容变化都特别大，但使用起来其实也很简单，不用慌，也有相同的地方：</p><ol><li><p>父组件不需要知道哪些子组件使用它 provide 的 property</p></li><li><p>子组件不需要知道 inject property 来自哪里</p></li></ol><p>另外，要切记一点就是：provide 和 inject 绑定并不是可响应的。这是刻意为之的，但如果传入了一个可监听的对象，那么其对象的 property 还是可响应的。</p></div><h3 id="发起-provide-new" tabindex="-1"><a class="header-anchor" href="#发起-provide-new" aria-hidden="true">#</a> 发起 provide{new}</h3><p>我们先来回顾一下 2.x 的用法：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义好数据</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      tags<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;中餐&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;粤菜&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;烧腊&#39;</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// provide出去</span>
  <span class="token function">provide</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      tags<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tags
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>旧版的 <code>provide</code> 用法和 <code>data</code> 类似，都是配置为一个返回对象的函数。</p><p>3.x 的新版 <code>provide</code>， 和 2.x 的用法区别比较大。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>在 3.x ， <code>provide</code> 需要导入并在 <code>setup</code> 里启用，并且现在是一个全新的方法。</p><p>每次要 <code>provide</code> 一个数据的时候，就要单独调用一次。</p></div><p>每次调用的时候，都需要传入 2 个参数：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">key</td><td style="text-align:left;">string</td><td style="text-align:left;">数据的名称</td></tr><tr><td style="text-align:left;">value</td><td style="text-align:left;">any</td><td style="text-align:left;">数据的值</td></tr></tbody></table><p>来看一下如何创建一个 <code>provide</code>：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 记得导入provide</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义好数据</span>
    <span class="token keyword">const</span> msg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">;</span>

    <span class="token comment">// provide出去</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>操作非常简单对吧哈哈哈，但需要注意的是，<code>provide</code> 不是响应式的，如果你要使其具备响应性，你需要传入响应式数据，详见：<a href="#%E5%93%8D%E5%BA%94%E6%80%A7%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BC%A0%E9%80%92%E4%B8%8E%E6%8E%A5%E6%94%B6-new">响应性数据的传递与接收</a></p><h3 id="接收-inject-new" tabindex="-1"><a class="header-anchor" href="#接收-inject-new" aria-hidden="true">#</a> 接收 inject{new}</h3><p>也是先来回顾一下 2.x 的用法：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;tags&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>旧版的 <code>inject</code> 用法和 <code>props</code> 类似，3.x 的新版 <code>inject</code>， 和 2.x 的用法区别也是比较大。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>在 3.x， <code>inject</code> 和 <code>provide</code> 一样，也是需要先导入然后在 <code>setup</code> 里启用，也是一个全新的方法。</p><p>每次要 <code>inject</code> 一个数据的时候，就要单独调用一次。</p></div><p>每次调用的时候，只需要传入 1 个参数：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">key</td><td style="text-align:left;">string</td><td style="text-align:left;">与 <code>provide</code> 相对应的数据名称</td></tr></tbody></table><p>来看一下如何创建一个 <code>inject</code>：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 记得导入inject</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>也是很简单（写 TS 的话，由于 <code>inject</code> 到的值可能是 <code>undefined</code>，所以要么加个 <code>undefined</code> 类型，要么给变量设置一个空的默认值）。</p><h3 id="响应性数据的传递与接收-new" tabindex="-1"><a class="header-anchor" href="#响应性数据的传递与接收-new" aria-hidden="true">#</a> 响应性数据的传递与接收{new}</h3><p>之所以要单独拿出来说， 是因为变化真的很大 - -</p><p>在前面我们已经知道，provide 和 inject 本身不可响应，但是并非完全不能够拿到响应的结果，只需要我们传入的数据具备响应性，它依然能够提供响应支持。</p><p>我们以 <code>ref</code> 和 <code>reactive</code> 为例，来看看应该怎么发起 <code>provide</code> 和接收 <code>inject</code>。</p><p>对这 2 个 API 还不熟悉的同学，建议先阅读一下 <a href="/component.html#%E5%93%8D%E5%BA%94%E5%BC%8F-api-%E4%B9%8B-ref-new" class="">响应式 API 之 ref</a> 和 <a href="/component.html#%E5%93%8D%E5%BA%94%E5%BC%8F-api-%E4%B9%8B-reactive-new" class="">响应式 API 之 reactive</a> 。</p><p>先在 <code>Grandfather.vue</code> 里 <code>provide</code> 数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// provide一个ref</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// provide一个reactive</span>
    <span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&#39;Petter&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;userInfo&#39;</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2s 后更新数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 修改消息内容</span>
      msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;Hi World!&#39;</span><span class="token punctuation">;</span>

      <span class="token comment">// 修改用户名</span>
      userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;Tom&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>在 <code>Grandsun.vue</code> 里 <code>inject</code> 拿到数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取数据</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;userInfo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印刚刚拿到的数据</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 因为 2s 后数据会变，我们 3s 后再看下，可以争取拿到新的数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 响应式数据还可以直接给 template 使用，会实时更新</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">,</span>
      userInfo
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>非常简单，非常方便！！！</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>响应式的数据 <code>provide</code> 出去，在子孙组件拿到的也是响应式的，并且可以如同自身定义的响应式变量一样，直接 <code>return</code> 给 <code>template</code> 使用，一旦数据有变化，视图也会立即更新。</p><p>但上面这句话有效的前提是，不破坏数据的响应性，比如 ref 变量，你需要完整的传入，而不能只传入它的 <code>value</code>，对于 <code>reactive</code> 也是同理，不能直接解构去破坏原本的响应性。</p><p>切记！切记！！！</p></div><h3 id="引用类型的传递与接收" tabindex="-1"><a class="header-anchor" href="#引用类型的传递与接收" aria-hidden="true">#</a> 引用类型的传递与接收</h3><blockquote><p>这里是针对非响应性数据的处理</p></blockquote><p>provide 和 inject 并不是可响应的，这是官方的故意设计，但是由于引用类型的特殊性，在子孙组件拿到了数据之后，他们的属性还是可以正常的响应变化。</p><p>先在 <code>Grandfather.vue</code> 里 <code>provide</code> 数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// provide 一个数组</span>
    <span class="token keyword">const</span> tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&#39;中餐&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;粤菜&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;烧腊&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;tags&#39;</span><span class="token punctuation">,</span> tags<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// provide 一个对象</span>
    <span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&#39;Petter&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;userInfo&#39;</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2s 后更新数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 增加tags的长度</span>
      tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;叉烧&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 修改userInfo的属性值</span>
      userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;Tom&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>在 <code>Grandsun.vue</code> 里 <code>inject</code> 拿到数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取数据</span>
    <span class="token keyword">const</span> tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;tags&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;userInfo&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印刚刚拿到的数据</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 因为 2s 后数据会变，我们 3s 后再看下，能够看到已经是更新后的数据了</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>引用类型的数据，拿到后可以直接用，属性的值更新后，子孙组件也会被更新。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>由于不具备真正的响应性，<code>return</code> 给模板使用依然不会更新视图，如果涉及到视图的数据，请依然使用 <a href="/component.html#%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%98%E5%8C%96-new" class="">响应式 API</a> 。</p></div><h3 id="基本类型的传递与接收" tabindex="-1"><a class="header-anchor" href="#基本类型的传递与接收" aria-hidden="true">#</a> 基本类型的传递与接收</h3><blockquote><p>这里是针对非响应性数据的处理</p></blockquote><p>基本数据类型被直接 <code>provide</code> 出去后，再怎么修改，都无法更新下去，子孙组件拿到的永远是第一次的那个值。</p><p>先在 <code>Grandfather.vue</code> 里 <code>provide</code> 数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// provide 一个数组的长度</span>
    <span class="token keyword">const</span> tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&#39;中餐&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;粤菜&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;烧腊&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;tagsCount&#39;</span><span class="token punctuation">,</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// provide 一个字符串</span>
    <span class="token keyword">let</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;Petter&#39;</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2s 后更新数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// tagsCount 在 Grandson 那边依然是 3</span>
      tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;叉烧&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// name 在 Grandson 那边依然是 Petter</span>
      name <span class="token operator">=</span> <span class="token string">&#39;Tom&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在 <code>Grandsun.vue</code> 里 <code>inject</code> 拿到数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取数据</span>
    <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> tagsCount<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;tagsCount&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印刚刚拿到的数据</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tagsCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 因为 2s 后数据会变，我们 3s 后再看下</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 依然是 Petter</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 依然是 3</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tagsCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>很失望，并没有变化。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>那么是否一定要定义成响应式数据或者引用类型数据呢？</p><p>当然不是，我们在 <code>provide</code> 的时候，也可以稍作修改，让它能够同步更新下去。</p></div><p>我们再来一次，依然是先在 <code>Grandfather.vue</code> 里 <code>provide</code> 数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// provide 一个数组的长度</span>
    <span class="token keyword">const</span> tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&#39;中餐&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;粤菜&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;烧腊&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;tagsCount&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// provide 字符串</span>
    <span class="token keyword">let</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;Petter&#39;</span><span class="token punctuation">;</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2s 后更新数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// tagsCount 现在可以正常拿到 4 了</span>
      tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;叉烧&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// name 现在可以正常拿到 Tom 了</span>
      name <span class="token operator">=</span> <span class="token string">&#39;Tom&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>再来 <code>Grandsun.vue</code> 里修改一下 <code>inject</code> 的方式，看看这次拿到的数据：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取数据</span>
    <span class="token keyword">const</span> tagsCount<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;tagsCount&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印刚刚拿到的数据</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">tagsCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 因为 2s 后数据会变，我们 3s 后再看下</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 现在可以正确得到 4</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">tagsCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 现在可以正确得到 Tom</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这次可以正确拿到数据了，看出这2次的写法有什么区别了吗？</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>基本数据类型，需要 <code>provide</code> 一个函数，将其 <code>return</code> 出去给子孙组件用，这样子孙组件每次拿到的数据才会是新的。</p><p>但由于不具备响应性，所以子孙组件每次都需要重新通过执行 <code>inject</code> 得到的函数才能拿到最新的数据。</p></div><p>按我个人习惯来说，使用起来挺别扭的，能不用就不用……</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>由于不具备真正的响应性，<code>return</code> 给模板使用依然不会更新视图，如果涉及到视图的数据，请依然使用 <a href="/component.html#%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%98%E5%8C%96-new" class="">响应式 API</a> 。</p></div><h2 id="兄弟组件通信" tabindex="-1"><a class="header-anchor" href="#兄弟组件通信" aria-hidden="true">#</a> 兄弟组件通信</h2><p>兄弟组件是指两个组件都挂载在同一个 <code>Father.vue</code> 下，但两个组件之间并没有什么直接的关联，先看看他们的关系：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Father.vue
├─Brother.vue
└─LittleBrother.vue
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>既然没有什么直接关联， ╮(╯▽╰)╭ 所以也没有什么专属于他们的通信方式。</p><p>如果他们之间要交流，目前大概有这两类选择：</p><ol><li><p>【不推荐】先把数据传给 <code>Father.vue</code>，再通过 <a href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">父子组件通信</a> 的方案去交流</p></li><li><p>【推荐】借助 <a href="#%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1">全局组件通信</a> 的方案才能达到目的。</p></li></ol><h2 id="全局组件通信" tabindex="-1"><a class="header-anchor" href="#全局组件通信" aria-hidden="true">#</a> 全局组件通信</h2><p>全局组件通信是指，两个任意的组件，不管是否有关联（e.g. 父子、爷孙）的组件，都可以直接进行交流的通信方案。</p><p>举个例子，像下面这样，<code>B2.vue</code> 可以采用全局通信方案，直接向 <code>D2.vue</code> 发起交流，而无需经过他们的父组件。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>A.vue
├─B1.vue
├───C1.vue
├─────D1.vue
├─────D2.vue
├───C2.vue
├─────D3.vue
└─B2.vue
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>常用的方法有：</p><table><thead><tr><th style="text-align:left;">方案</th><th style="text-align:left;">发起方</th><th style="text-align:left;">接收方</th><th style="text-align:left;">对应章节传送门</th></tr></thead><tbody><tr><td style="text-align:left;">EventBus</td><td style="text-align:left;">emit</td><td style="text-align:left;">on</td><td style="text-align:left;"><a href="#eventbus-new">点击查看</a></td></tr><tr><td style="text-align:left;">Vuex</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td><td style="text-align:left;"><a href="#vuex-new">点击查看</a></td></tr></tbody></table><h2 id="eventbus-new" tabindex="-1"><a class="header-anchor" href="#eventbus-new" aria-hidden="true">#</a> EventBus{new}</h2><p><code>EventBus</code> 通常被称之为 “全局事件总线” ，它是用来在全局范围内通信的一个常用方案，它的特点就是： “简单” 、 “灵活” 、“轻量级”。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>在中小型项目，全局通信推荐优先采用该方案，事件总线在打包压缩后不到 200 个字节， API 也非常简单和灵活。</p></div><h3 id="回顾-vue-2" tabindex="-1"><a class="header-anchor" href="#回顾-vue-2" aria-hidden="true">#</a> 回顾 Vue 2</h3><p>在 2.x，使用 EventBus 无需导入第三方插件，直接在自己的 <code>libs</code> 文件夹下创建一个 <code>bus.ts</code> 文件，暴露一个新的 Vue 实例即可。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后就可以在组件里引入 bus ，通过 <code>$emit</code> 去发起交流，通过 <code>$on</code> 去监听接收交流。</p><p>旧版方案的完整案例代码可以查看官方的 <a href="https://v3.cn.vuejs.org/guide/migration/events-api.html#_2-x-%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener noreferrer">2.x 语法 - 事件 API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="了解-vue-3-new" tabindex="-1"><a class="header-anchor" href="#了解-vue-3-new" aria-hidden="true">#</a> 了解 Vue 3{new}</h3><p>Vue 3 移除了 <code>$on</code> 、 <code>$off</code> 和 <code>$once</code> 这几个事件 API ，应用实例不再实现事件触发接口。</p><p>根据官方文档在 <a href="https://v3.cn.vuejs.org/guide/migration/events-api.html#%E8%BF%81%E7%A7%BB%E7%AD%96%E7%95%A5" target="_blank" rel="noopener noreferrer">迁移策略 - 事件 API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的推荐，我们可以用 <a href="https://github.com/developit/mitt" target="_blank" rel="noopener noreferrer">mitt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 或者 <a href="https://github.com/scottcorgan/tiny-emitter" target="_blank" rel="noopener noreferrer">tiny-emitter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 等第三方插件来实现 <code>EventBus</code> 。</p><h3 id="创建-3-x-的-eventbus-new" tabindex="-1"><a class="header-anchor" href="#创建-3-x-的-eventbus-new" aria-hidden="true">#</a> 创建 3.x 的 EventBus{new}</h3><p>这里以 <code>mitt</code> 为例，示范如何创建一个 Vue 3 的 <code>EventBus</code> 。</p><p>首先，需要安装 <code>mitt</code> ：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm install --save mitt
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后在 <code>libs</code> 文件夹下，创建一个 <code>bus.ts</code> 文件，内容和旧版写法其实是一样的，只不过是把 Vue 实例，换成了 mitt 实例。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> mitt <span class="token keyword">from</span> <span class="token string">&#39;mitt&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">mitt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后就可以定义发起和接收的相关事件了，常用的 API 和参数如下：</p><table><thead><tr><th style="text-align:left;">方法名称</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">on</td><td style="text-align:left;">注册一个监听事件，用于接收数据</td></tr><tr><td style="text-align:left;">emit</td><td style="text-align:left;">调用方法发起数据传递</td></tr><tr><td style="text-align:left;">off</td><td style="text-align:left;">用来移除监听事件</td></tr></tbody></table><p><code>on</code> 的参数：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">type</td><td style="text-align:left;">string | symbol</td><td style="text-align:left;">方法名</td></tr><tr><td style="text-align:left;">handler</td><td style="text-align:left;">function</td><td style="text-align:left;">接收到数据之后要做什么处理的回调函数</td></tr></tbody></table><p>这里的 <code>handler</code> 建议使用具名函数，因为匿名函数无法销毁。</p><p><code>emit</code> 的参数：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">type</td><td style="text-align:left;">string | symbol</td><td style="text-align:left;">与 on 对应的方法名</td></tr><tr><td style="text-align:left;">data</td><td style="text-align:left;">any</td><td style="text-align:left;">与 on 对应的，允许接收的数据</td></tr></tbody></table><p><code>off</code> 的参数：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">type</td><td style="text-align:left;">string | symbol</td><td style="text-align:left;">与 on 对应的方法名</td></tr><tr><td style="text-align:left;">handler</td><td style="text-align:left;">function</td><td style="text-align:left;">要删除的，与 on 对应的 handler 函数名</td></tr></tbody></table><p>更多的 API 可以查阅 <a href="https://github.com/developit/mitt" target="_blank" rel="noopener noreferrer">插件的官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ，在了解了最基本的用法之后，我们来开始配置一对交流。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>如果你需要把 <code>bus</code> 配置为全局 API ，不想在每个组件里分别 import 的话，可以参考之前的章节内容： <a href="/plugin.html#%E5%85%A8%E5%B1%80-api-%E6%8C%82%E8%BD%BD" class="">全局 API 挂载</a> 。</p></div><h3 id="创建和移除监听事件-new" tabindex="-1"><a class="header-anchor" href="#创建和移除监听事件-new" aria-hidden="true">#</a> 创建和移除监听事件{new}</h3><p>在需要暴露交流事件的组件里，通过 <code>on</code> 配置好接收方法，同时为了避免路由切换过程中造成事件多次被绑定，多次触发，需要在适当的时机 <code>off</code> 掉：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> onBeforeUnmount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">&#39;@libs/bus&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个打招呼的方法</span>
    <span class="token keyword">const</span> sayHi <span class="token operator">=</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 启用监听</span>
    bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;sayHi&#39;</span><span class="token punctuation">,</span> sayHi<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在组件卸载之前移除监听</span>
    <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      bus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;sayHi&#39;</span><span class="token punctuation">,</span> sayHi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>关于销毁的时机，可以参考 <a href="/component.html#%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-new" class="">组件的生命周期</a> 。</p><h3 id="调用监听事件-new" tabindex="-1"><a class="header-anchor" href="#调用监听事件-new" aria-hidden="true">#</a> 调用监听事件{new}</h3><p>在需要调用交流事件的组件里，通过 <code>emit</code> 进行调用：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">&#39;@libs/bus&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用打招呼事件，传入消息内容</span>
    bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;sayHi&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;哈哈哈哈哈哈哈哈哈哈哈哈哈哈&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="旧项目升级-eventbus" tabindex="-1"><a class="header-anchor" href="#旧项目升级-eventbus" aria-hidden="true">#</a> 旧项目升级 EventBus</h3><p>在 <a href="#%E5%88%9B%E5%BB%BA-3-x-%E7%9A%84-eventbus-new">Vue 3 的 EventBus</a>，我们可以看到它的 API 和旧版是非常接近的，只是去掉了 <code>$</code> 符号。</p><p>如果你要对旧的项目进行升级改造，因为原来都是使用了 <code>$on</code> 、 <code>$emit</code> 等旧的 API ，一个一个组件去修改成新的 API 肯定不现实。</p><p>我们可以在创建 <code>bus.ts</code> 的时候，通过自定义一个 <code>bus</code> 对象，来挂载 <code>mitt</code> 的 API 。</p><p>在 <code>bus.ts</code> 里，改成以下代码：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> mitt <span class="token keyword">from</span> <span class="token string">&#39;mitt&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 初始化一个 mitt 实例</span>
<span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token function">mitt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义一个空对象用来承载我们的自定义方法</span>
<span class="token keyword">const</span> bus<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 把你要用到的方法添加到 bus 对象上</span>
bus<span class="token punctuation">.</span>$on <span class="token operator">=</span> emitter<span class="token punctuation">.</span>on<span class="token punctuation">;</span>
bus<span class="token punctuation">.</span>$emit <span class="token operator">=</span> emitter<span class="token punctuation">.</span>emit<span class="token punctuation">;</span>

<span class="token comment">// 最终是暴露自己定义的 bus</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> bus<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这样我们在组件里就可以继续使用 <code>bus.$on</code> 、<code>bus.$emit</code> 等以前的老 API 了，不影响我们旧项目的升级使用。</p><h2 id="vuex-new" tabindex="-1"><a class="header-anchor" href="#vuex-new" aria-hidden="true">#</a> Vuex{new}</h2><p>Vuex 是 Vue 生态里面非常重要的一个成员，运用于状态管理模式。</p><p>它也是一个全局的通信方案，对比 <a href="#eventbus-new">EventBus</a>，Vuex 的功能更多，更灵活，但对应的，学习成本和体积也相对较大，通常大型项目才会用上 Vuex。</p><p>摘取一段官网的介绍，官方也只建议在大型项目里才用它：</p><blockquote><p><strong>什么情况下我应该使用 Vuex？</strong><br> Vuex 可以帮助我们管理共享状态，并附带了更多的概念和框架。这需要对短期和长期效益进行权衡。<br> 如果您不打算开发大型单页应用，使用 Vuex 可能是繁琐冗余的。</p></blockquote><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>2022-04-07 注：如果是全新的项目，建议直接上手 <a href="#pinia-new">Pinia</a> ，无需再用 Vuex 。</p></div><h3 id="在了解之前" tabindex="-1"><a class="header-anchor" href="#在了解之前" aria-hidden="true">#</a> 在了解之前</h3><p>在对 Vue 3 里是否需要使用 Vuex 的问题上，带有一定的争议，大部分开发者在社区发表的评论都认为通过 <a href="#eventbus-new">EventBus</a> 和 <a href="#provide-inject">provide / inject</a> ，甚至 export 一个 <a href="/component.html#%E5%93%8D%E5%BA%94%E5%BC%8F-api-%E4%B9%8B-reactive-new" class="">reactive</a> 对象也足以满足大部分业务需求。</p><p>见仁见智，请根据自己的实际需要去看是否需要启用它。</p><p>好在新版 Vuex 和旧版几乎没什么区别，大家可以了解一下大概的变化之后，按照之前的官网文档去配置，使用其他应该没有太大的问题。</p><h3 id="vuex-的目录结构" tabindex="-1"><a class="header-anchor" href="#vuex-的目录结构" aria-hidden="true">#</a> Vuex 的目录结构</h3><p>如果你在创建 Vue 项目的时候选择了带上 Vuex ，那么 <code>src</code> 文件夹下会自动生成 Vuex 的相关文件，如果创建时没有选择，你也可以自己按照下面解构去创建对应的目录与文件。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>src
├─store
├───index.ts
└─main.ts
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一般情况下一个 <code>index.ts</code> 足矣，它是 Vuex 的入口文件，如果你的项目比较庞大，你可以在 <code>store</code> 下创建一个 <code>modules</code> 文件夹，用 Vuex Modules 的方式导入到 <code>index.ts</code> 里去注册。</p><h3 id="回顾-vue-2-1" tabindex="-1"><a class="header-anchor" href="#回顾-vue-2-1" aria-hidden="true">#</a> 回顾 Vue 2</h3><p>在 2.x ，你需要先分别导入 <code>Vue</code> 和 <code>Vuex</code>，<code>use</code> 后通过 <code>new Vuex.Store(...)</code> 的方式去初始化</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex</span><span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="了解-vue-3-new-1" tabindex="-1"><a class="header-anchor" href="#了解-vue-3-new-1" aria-hidden="true">#</a> 了解 Vue 3{new}</h3><p>而 3.x 简化了很多，只需要从 <code>vuex</code> 里导入 <code>createStore</code>，直接通过 <code>createStore</code> 去创建即可。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="vuex-的配置" tabindex="-1"><a class="header-anchor" href="#vuex-的配置" aria-hidden="true">#</a> Vuex 的配置</h3><p>除了初始化方式有一定的改变，Vuex 的其他的配置和原来是一样的，具体可以查看 <a href="https://next.vuex.vuejs.org/zh/guide/" target="_blank" rel="noopener noreferrer">使用指南 - Vuex<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="在组件里使用-vuex-new" tabindex="-1"><a class="header-anchor" href="#在组件里使用-vuex-new" aria-hidden="true">#</a> 在组件里使用 Vuex{new}</h3><p>和 2.x 不同的是，3.x 在组件里使用 Vuex，更像新路由那样，需要通过 <code>useStore</code> 去启用。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要创建一个 store 变量</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 再使用 store 去操作 Vuex 的 API</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>其他的用法，都是跟原来一样的。</p><h2 id="pinia-new" tabindex="-1"><a class="header-anchor" href="#pinia-new" aria-hidden="true">#</a> Pinia{new}</h2><p>Pinia 和 Vuex 一样，也是 Vue 生态里面非常重要的一个成员，也都是运用于全局的状态管理。</p><p>但面向 <a href="/component.html#%E7%BB%84%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%86%99%E6%B3%95" class="">Componsition API</a> 而生的 Pinia ，更受 Vue 3 喜爱，已被钦定为官方推荐的新状态管理工具。</p><p>为了阅读上的方便，对 Pinia 单独开了一章，请跳转至 <a href="/pinia.html" class="">全局状态的管理</a> 阅读。</p><h2 id="本章结语" tabindex="-1"><a class="header-anchor" href="#本章结语" aria-hidden="true">#</a> 本章结语</h2><p>组件的通信在中大型项目里非常实用，它可以让你的组件避免写的又长又臭，可以按模块去拆分成不同的组件，然后通过组件之间的通信方式来关联起来。</p><!----><!----><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/chengpeiquan/learning-vue3/edit/main/docs/communication.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: chengpeiquan@chengpeiquan.com">chengpeiquan</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/plugin.html" class="" aria-label="插件的使用"><!--[--><!--]--> 插件的使用 <!--[--><!--]--></a></span><span class="next"><a href="/pinia.html" class="" aria-label="全局状态的管理"><!--[--><!--]--> 全局状态的管理 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.0c7b3152.js" defer></script>
  </body>
</html>
